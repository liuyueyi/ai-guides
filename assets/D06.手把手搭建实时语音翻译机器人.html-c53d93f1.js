import{_ as c,V as i,W as l,Y as n,a0 as s,Z as a,X as p,F as o}from"./framework-2236aa4f.js";const u={},r=p(`<h1 id="spring-ai-å®æˆ˜-æ‰‹æŠŠæ‰‹æ­å»ºå®æ—¶è¯­éŸ³ç¿»è¯‘æœºå™¨äºº" tabindex="-1"><a class="header-anchor" href="#spring-ai-å®æˆ˜-æ‰‹æŠŠæ‰‹æ­å»ºå®æ—¶è¯­éŸ³ç¿»è¯‘æœºå™¨äºº" aria-hidden="true">#</a> Spring AI å®æˆ˜ï¼šæ‰‹æŠŠæ‰‹æ­å»ºå®æ—¶è¯­éŸ³ç¿»è¯‘æœºå™¨äºº</h1><p>å®æ—¶ç¿»è¯‘çš„åœºæ™¯å¯ä»¥è¯´åº”ç”¨å¾ˆä¹…äº†ï¼Œå½“ç„¶åœ¨ä»¥å‰è¿™ä¸ªå®ç°è¿˜æ˜¯å¾ˆæœ‰æŒ‘æˆ˜çš„ï¼Œä¸è¿‡ç°å¦‚ä»Šå˜›ï¼Œåœ¨AIçš„åŠ æŒä¸‹ï¼Œåƒæˆ‘ä»¬è¿™ç§æ™®é€šçš„ç¼–ç¨‹äººå‘˜ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°ä¸€ä¸ªè¯­éŸ³ç¿»è¯‘æœºå™¨äººã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘å°†å¸¦ä½ åŸºäº Spring AI æ¡†æ¶ï¼Œä»é›¶æ­å»ºä¸€ä¸ªæ”¯æŒéŸ³é¢‘è½¬å½•ä¸ç¿»è¯‘çš„æ™ºèƒ½æœºå™¨äººã€‚</p><h2 id="ä¸€ã€ç¯å¢ƒå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€ç¯å¢ƒå‡†å¤‡" aria-hidden="true">#</a> ä¸€ã€ç¯å¢ƒå‡†å¤‡</h2><p>åœ¨å¼€å§‹å®æˆ˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡å¥½å¼€å‘ç¯å¢ƒã€‚ä»¥ä¸‹æ˜¯æœ¬æ–‡æ‰€ä½¿ç”¨çš„æŠ€æœ¯æ ˆï¼š</p><table><thead><tr><th>ç»„ä»¶</th><th>ç‰ˆæœ¬/è¯´æ˜</th></tr></thead><tbody><tr><td>JDK</td><td>17 åŠä»¥ä¸Š</td></tr><tr><td>Spring Boot</td><td>3.x</td></tr><tr><td>Spring AI</td><td>1.1.2</td></tr><tr><td>éŸ³é¢‘è½¬å½•æ¨¡å‹</td><td><code>FunAudioLLM/SenseVoiceSmall</code></td></tr><tr><td>å¯¹è¯å¤§æ¨¡å‹</td><td><code>Qwen/Qwen2.5-7B-Instruct</code></td></tr><tr><td>API å¹³å°</td><td>SiliconFlowï¼ˆéœ€è‡ªè¡Œç”³è¯· API Keyï¼‰</td></tr></tbody></table><h3 id="_1-1-apikeyç”³è¯·" tabindex="-1"><a class="header-anchor" href="#_1-1-apikeyç”³è¯·" aria-hidden="true">#</a> 1.1 APIKeyç”³è¯·</h3><p>ä½ éœ€è¦ SiliconFlow å¹³å°ç”³è¯· API Keyï¼Œå¹¶åœ¨ <code>application.yml</code> ä¸­é…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">ai</span><span class="token punctuation">:</span>
    <span class="token key atrule">openai</span><span class="token punctuation">:</span>
      <span class="token key atrule">api-key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>silicon<span class="token punctuation">-</span>api<span class="token punctuation">-</span>key<span class="token punctuation">}</span>  <span class="token comment"># æ›¿æ¢ä¸ºä½ çš„API Key</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),k=n("p",null,"è¿™é‡Œé€‰æ‹©SiliconFlowçš„ä¸»è¦åŸå› æ˜¯å®ƒçš„å…è´¹æ¨¡å‹ï¼Œå¯¹äºæƒ³è¦å¤åˆ»ä½“éªŒæœ¬é¡¹ç›®çš„å°ä¼™ä¼´æœ€å‹å¥½ğŸ˜Š",-1),d={href:"https://cloud.siliconflow.cn/i/ge3VpPHH",target:"_blank",rel:"noopener noreferrer"},m=n("p",null,[s("ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡äºŒç»´ç æ³¨å†Œï¼š"),n("img",{src:"https://imgbed.ppai.top/file/1772435807988_silicon_reqr.png",alt:"image.png",loading:"lazy"})],-1),v=p(`<h3 id="_1-2-æ ¸å¿ƒä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_1-2-æ ¸å¿ƒä¾èµ–" aria-hidden="true">#</a> 1.2 æ ¸å¿ƒä¾èµ–</h3><p>ç›´æ¥ä½¿ç”¨<code>openai-starter</code>æ¥å®ç°å¤§æ¨¡å‹çš„äº¤äº’ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®çš„å®ç°ä¸­ï¼Œä¸»è¦åŒ…å«ä¸¤ç±»çš„å¤§æ¨¡å‹äº¤äº’è¿‡ç¨‹</p><ul><li>éŸ³é¢‘è¯†åˆ«ï¼šè¯†åˆ«è¯­éŸ³æ–‡ä»¶çš„å†…å®¹</li><li>æ–‡å­—ç¿»è¯‘ï¼šå°†è¯­éŸ³å†…å®¹ç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€</li></ul><p>æœ‰éœ€è¦çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥åœ¨å®ç° <code>æ–‡å­—è½¬è¯­éŸ³</code> TTSçš„å®ç°ï¼Œä»è€Œè·å–æ›´å¥½çš„ä½¿ç”¨ä½“éªŒ</p><p>å¯¹åº”çš„pomæ ¸å¿ƒä¾èµ–å¦‚ä¸‹</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- å¤§æ¨¡å‹äº¤äº’çš„æ ¸å¿ƒä¾èµ– --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.ai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-ai-starter-model-openai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- æä¾›webé¡µé¢ + æ¥å£äº¤äº’çš„å®ç°æ”¯æ’‘ --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-3-é…ç½®" aria-hidden="true">#</a> 1.3 é…ç½®</h3><p>æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ <code>resources/application.yml</code> ç»´æŠ¤ä¸Šæ¨¡å‹å’Œapikey</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">thymeleaf</span><span class="token punctuation">:</span>
    <span class="token key atrule">cache</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">ai</span><span class="token punctuation">:</span>
    <span class="token key atrule">openai</span><span class="token punctuation">:</span>
      <span class="token comment"># api-key ä½¿ç”¨ä½ è‡ªå·±ç”³è¯·çš„è¿›è¡Œæ›¿æ¢ï¼›å¦‚æœä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°è¿›è¡Œè®¾ç½®</span>
      <span class="token key atrule">api-key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>silicon<span class="token punctuation">-</span>api<span class="token punctuation">-</span>key<span class="token punctuation">}</span>
      <span class="token key atrule">transcription</span><span class="token punctuation">:</span>
        <span class="token key atrule">api-key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>silicon<span class="token punctuation">-</span>api<span class="token punctuation">-</span>key<span class="token punctuation">}</span>
        <span class="token key atrule">base-url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//api.siliconflow.cn/v1
        <span class="token key atrule">transcription-path</span><span class="token punctuation">:</span> /audio/transcriptions
        <span class="token key atrule">options</span><span class="token punctuation">:</span>
          <span class="token key atrule">model</span><span class="token punctuation">:</span> FunAudioLLM/SenseVoiceSmall
          <span class="token key atrule">response-format</span><span class="token punctuation">:</span> text
      <span class="token key atrule">chat</span><span class="token punctuation">:</span> <span class="token comment"># èŠå¤©æ¨¡å‹</span>
        <span class="token key atrule">options</span><span class="token punctuation">:</span>
          <span class="token key atrule">model</span><span class="token punctuation">:</span> Qwen/Qwen2.5<span class="token punctuation">-</span>7B<span class="token punctuation">-</span>Instruct
      <span class="token key atrule">base-url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//api.siliconflow.cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äºŒã€æ ¸å¿ƒå®ç°" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ ¸å¿ƒå®ç°" aria-hidden="true">#</a> äºŒã€æ ¸å¿ƒå®ç°</h2><h3 id="_2-0-æ•´ä½“æ–¹æ¡ˆè®¾è®¡" tabindex="-1"><a class="header-anchor" href="#_2-0-æ•´ä½“æ–¹æ¡ˆè®¾è®¡" aria-hidden="true">#</a> 2.0 æ•´ä½“æ–¹æ¡ˆè®¾è®¡</h3><p>åœ¨å…·ä½“çš„å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªå®æ—¶ç¿»è¯‘åŠŸèƒ½å¯ä»¥æ€ä¹ˆè®¾è®¡ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡æµç¨‹å›¾</p><figure><img src="https://imgbed.ppai.top/file/1772437882441_D06-1.webp" alt="D06-1.webp" tabindex="0" loading="lazy"><figcaption>D06-1.webp</figcaption></figure>`,13),g=p(`<p><strong>ä¸ºä»€ä¹ˆé‡‡ç”¨å¼‚æ­¥ï¼Ÿ</strong></p><p>è€ƒè™‘åˆ°äº¤äº’ä½“éªŒï¼ŒåŒæ­¥é˜»å¡ä¸€ç›´ç­‰å¾…åç«¯è¿”å›å…¨éƒ¨ç»“æœçš„æ–¹æ¡ˆä¸å¯å–ï¼ˆå› ä¸ºè€—æ—¶å¯èƒ½å¾ˆä¹…ï¼‰ï¼›å› æ­¤å®æ—¶çš„äº¤äº’å¿…ç„¶æ˜¯é¦–é€‰ï¼Œå› æ­¤å¼‚æ­¥çš„åŸå› å¦‚ä¸‹ï¼š</p><ul><li>éŸ³é¢‘å¤„ç†è€—æ—¶è¾ƒé•¿ï¼ˆé€šå¸¸å‡ ç§’åˆ°å‡ åç§’ï¼‰</li><li>åŒæ­¥ç­‰å¾…ä¼šè®©ç”¨æˆ·ç•Œé¢å¡é¡¿</li><li>ç”¨æˆ·ä½“éªŒå·®ï¼Œå®¹æ˜“è¯¯è®¤ä¸ºç³»ç»Ÿæ— å“åº”</li></ul><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ç”¨æˆ·ä¸Šä¼ éŸ³é¢‘
    â†“
ç«‹å³è¿”å›ä»»åŠ¡IDï¼ˆ100mså†…ï¼‰
    â†“
åå°å¼‚æ­¥å¤„ç†
    â†“
å®æ—¶æ¨é€å¤„ç†è¿›åº¦
    â†“
ç”¨æˆ·è·å¾—æœ€ç»ˆç»“æœ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>SSE (Server-Sent Events) é€‰æ‹©ç†ç”±ï¼š</strong></p><ul><li>ğŸ”¸ å•å‘æ¨é€ï¼ŒæœåŠ¡ç«¯ä¸»åŠ¨</li><li>ğŸ”¸ HTTPåè®®ï¼Œå…¼å®¹æ€§å¥½</li><li>ğŸ”¸ è‡ªåŠ¨é‡è¿æœºåˆ¶</li><li>ğŸ”¸ æ¯”WebSocketè½»é‡</li></ul><blockquote><p>è¯·æ³¨æ„SSEä¸æ”¯æŒPOSTè¯·æ±‚ï¼Œå› æ­¤ç”¨æˆ·é€šè¿‡POSTä¸Šä¼ éŸ³é¢‘ï¼Œæ‹¿åˆ°çš„æ˜¯tastIdï¼Œç„¶åå†åŸºäºtaskIdå‘èµ·ä¸€ä¸ªsseçš„è¯·æ±‚ï¼Œç”¨æˆ·å®æ—¶è·å–åç«¯å¤„ç†ç»“æœ</p></blockquote><p><strong>æ¨é€æ—¶æœºè®¾è®¡ï¼š</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>è½¬å½•å®Œæˆ â†’ ç«‹å³æ¨é€è¯†åˆ«æ–‡æœ¬
ç¿»è¯‘è¿›è¡Œä¸­ â†’ æµå¼æ¨é€ç¿»è¯‘ç‰‡æ®µ
ç¿»è¯‘å®Œæˆ â†’ å‘é€ç»“æŸä¿¡å·
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ä¹Ÿå¯ä»¥æ ¹æ®ä¸‹é¢çš„è¶…è¯¦ç»†çš„æ—¶åºå›¾ï¼Œæ¥çœ‹çœ‹è¿™ä¸ªå®æ—¶è¯­éŸ³ç¿»è¯‘çš„å®ç°æ€è·¯</p><figure><img src="https://imgbed.ppai.top/file/1772437555859_D06-2.webp" alt="D06-2.webp" tabindex="0" loading="lazy"><figcaption>D06-2.webp</figcaption></figure>`,12),b=n("h3",{id:"_2-1-éŸ³é¢‘è½¬å½•æœåŠ¡",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-1-éŸ³é¢‘è½¬å½•æœåŠ¡","aria-hidden":"true"},"#"),s(" 2.1 éŸ³é¢‘è½¬å½•æœåŠ¡")],-1),h={href:"https://www.ppai.top/ai-guides/ai-dev/%E5%9F%BA%E7%A1%80%E7%AF%87/18.%E8%AF%AD%E9%9F%B3%E6%A8%A1%E5%9E%8B%E4%B9%8B%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB.html",target:"_blank",rel:"noopener noreferrer"},f=p(`<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºéŸ³é¢‘è½¬å½•æœåŠ¡ï¼Œåˆ©ç”¨ Spring AI çš„ <code>TranscriptionModel</code> æ¥å£è°ƒç”¨ SenseVoiceSmall æ¨¡å‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AudioTransactionService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TranscriptionModel</span> transcriptionModel<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">audioTransaction</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// é…ç½®è½¬å½•é€‰é¡¹</span>
        <span class="token class-name">AudioTranscriptionOptions</span> options <span class="token operator">=</span> <span class="token class-name">OpenAiAudioTranscriptionOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">responseFormat</span><span class="token punctuation">(</span><span class="token class-name">OpenAiAudioApi<span class="token punctuation">.</span>TranscriptResponseFormat</span><span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;FunAudioLLM/SenseVoiceSmall&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å°†ä¸Šä¼ æ–‡ä»¶è½¬ä¸º Resource å¯¹è±¡</span>
        <span class="token class-name">Resource</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayResource</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// è°ƒç”¨è½¬å½•æœåŠ¡</span>
        <span class="token class-name">AudioTranscriptionPrompt</span> prompt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioTranscriptionPrompt</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AudioTranscriptionResponse</span> response <span class="token operator">=</span> transcriptionModel<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ</strong></p><p>Spring AI ç»Ÿä¸€äº† AI æ¨¡å‹çš„è°ƒç”¨æ¥å£ï¼Œ<code>TranscriptionModel</code> å±è”½äº†åº•å±‚ API çš„å·®å¼‚ï¼Œæˆ‘ä»¬åªéœ€å…³æ³¨ä¸šåŠ¡é€»è¾‘å³å¯ã€‚</p><p>ä¸Šé¢è¿™ä¸ªserviceå®ç°è¯†åˆ«éŸ³é¢‘æ–‡ä»¶å†…å®¹ï¼Œå¹¶ç›´æ¥è¿”å›ç»“æœç»™è°ƒç”¨æ–¹ï¼ˆæˆ‘ä»¬ç°åœ¨é€‰ä¸­çš„æ¨¡å‹ä¸»è¦æ”¯æŒä¸­è‹±æ–‡å†…å®¹çš„è¯†åˆ«ï¼‰</p><h3 id="_2-2-ç¿»è¯‘æœåŠ¡-sse-å®æ—¶æ¨é€" tabindex="-1"><a class="header-anchor" href="#_2-2-ç¿»è¯‘æœåŠ¡-sse-å®æ—¶æ¨é€" aria-hidden="true">#</a> 2.2 ç¿»è¯‘æœåŠ¡ + SSE å®æ—¶æ¨é€</h3><p>ä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬é‡‡ç”¨å¼‚æ­¥å¤„ç† + SSEï¼ˆServer-Sent Eventsï¼‰å®ç°å®æ—¶æ¨é€ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// å­˜å‚¨ä»»åŠ¡çŠ¶æ€çš„å†…å­˜æ˜ å°„</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">TranslationTask</span><span class="token punctuation">&gt;</span></span> taskMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SseEmitter</span><span class="token punctuation">&gt;</span></span> emitters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ç¿»è¯‘ä»»åŠ¡è®°å½•ç±»</span>
<span class="token keyword">private</span> <span class="token keyword">record</span> <span class="token class-name">TranslationTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> taskId<span class="token punctuation">,</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token class-name">String</span> targetLanguage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;uploadAudio&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">uploadAudio</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> 
        <span class="token class-name">String</span> targetLanguage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç”Ÿæˆå”¯ä¸€ä»»åŠ¡ID</span>
    <span class="token class-name">String</span> taskId <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    taskMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TranslationTask</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> file<span class="token punctuation">,</span> targetLanguage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// å¼‚æ­¥å¤„ç†ä»»åŠ¡</span>
    <span class="token function">processTranslationTask</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;taskId&quot;</span><span class="token punctuation">,</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;getResultStream/{taskId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">SseEmitter</span> <span class="token function">getResultStream</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SseEmitter</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SseEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    emitters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> emitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> emitter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³é”®çš„å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processTranslationTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¬¬ä¸€æ­¥ï¼šéŸ³é¢‘è½¬å½•</span>
        <span class="token class-name">String</span> transcription <span class="token operator">=</span> audioTransactionService<span class="token punctuation">.</span><span class="token function">audioTransaction</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sseEmitter<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">SseEmitter</span><span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;transcription&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>transcription<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç¬¬äºŒæ­¥ï¼šæµå¼ç¿»è¯‘</span>
        <span class="token class-name">PromptTemplate</span> promptTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PromptTemplate</span><span class="token punctuation">(</span><span class="token constant">TRANS_SYSTEM_PROMPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Prompt</span> prompt <span class="token operator">=</span> promptTemplate<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
                <span class="token string">&quot;lan&quot;</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>targetLanguage<span class="token punctuation">,</span>
                <span class="token string">&quot;content&quot;</span><span class="token punctuation">,</span> transcription<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> chatClient<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>txt <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            sseEmitter<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">SseEmitter</span><span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;translation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ³¨ï¼šä¸Šé¢çš„ä»£ç ä¸»è¦æ˜¾ç¤ºæ ¸å¿ƒçš„ä¸šåŠ¡ä½“ç°ï¼ŒçœŸå®çš„å®ç°ä¸­è¿˜åŒ…å«èµ„æºå›æ”¶ï¼ˆsseEmitterå…³é—­ï¼Œæ¸…é™¤ç¼“å­˜ä¿¡æ¯ç­‰ï¼‰,è¯¦æƒ…è¯·å‚è€ƒæ–‡æœ«çš„é¡¹ç›®æºç </p></blockquote><h3 id="_2-3-å‰ç«¯äº¤äº’" tabindex="-1"><a class="header-anchor" href="#_2-3-å‰ç«¯äº¤äº’" aria-hidden="true">#</a> 2.3 å‰ç«¯äº¤äº’</h3><p>å‰ç«¯é€šè¿‡ EventSource æ¥æ”¶ SSE æ¨é€ï¼Œå®ç°å®æ—¶æ˜¾ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// å»ºç«‹SSEè¿æ¥</span>
<span class="token keyword">const</span> eventSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/auto/getResultStream/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>taskId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eventSource<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;transcription&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;è½¬å½•ç»“æœ:&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;transcription&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eventSource<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;translation&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æµå¼æ˜¾ç¤ºç¿»è¯‘ç»“æœ</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;translation&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eventSource<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;end&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    eventSource<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸‰ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> ä¸‰ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="q1-é•¿éŸ³é¢‘è§£æè¾ƒæ…¢é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#q1-é•¿éŸ³é¢‘è§£æè¾ƒæ…¢é—®é¢˜" aria-hidden="true">#</a> Q1ï¼šé•¿éŸ³é¢‘è§£æè¾ƒæ…¢é—®é¢˜</h3><p><strong>é—®é¢˜</strong>ï¼šç°åœ¨å¤§æ¨¡å‹çš„è¯­éŸ³è¯†åˆ«ä¸ºåŒæ­¥è°ƒç”¨ï¼Œå¯¹äºé•¿éŸ³é¢‘è§£æè¾ƒæ…¢</p><p><strong>è§£å†³</strong>ï¼šå¯¹éŸ³é¢‘è¿›è¡Œåˆ‡å‰²ï¼Œå¹¶è¡Œè°ƒç”¨å¤§æ¨¡å‹æ¥å£ï¼ŒæŒ‰ç…§é¡ºåºè¿”å›ç»™å‰ç«¯ç”¨æˆ·</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¹¶è¡Œå¤„ç†éŸ³é¢‘æ–‡ä»¶ï¼ˆæ™ºèƒ½åˆ†å‰²ï¼‰
 * 
 * <span class="token keyword">@param</span> <span class="token parameter">file</span> éŸ³é¢‘æ–‡ä»¶
 * <span class="token keyword">@param</span> <span class="token parameter">useParallel</span> æ˜¯å¦ä½¿ç”¨å¹¶è¡Œå¤„ç†
 * <span class="token keyword">@return</span> è½¬å½•ç»“æœ
 */</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">audioTransactionParallel</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token keyword">boolean</span> useParallel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>useParallel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">audioTransactionSingle</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ™ºèƒ½åˆ†å‰²éŸ³é¢‘</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AudioSegmentationService<span class="token punctuation">.</span>AudioSegment</span><span class="token punctuation">&gt;</span></span> segments <span class="token operator">=</span> segmentationService<span class="token punctuation">.</span><span class="token function">smartSegment</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>segments<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;éŸ³é¢‘æ–‡ä»¶è¾ƒå°ï¼Œç›´æ¥å¤„ç†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">audioTransactionSingle</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// å¹¶è¡Œå¤„ç†æ‰€æœ‰ç‰‡æ®µ</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> futures <span class="token operator">=</span> segmentationService<span class="token punctuation">.</span><span class="token function">processSegmentsParallel</span><span class="token punctuation">(</span>
            segments<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">transcribeSegment</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// æ”¶é›†ç»“æœ</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> segmentationService<span class="token punctuation">.</span><span class="token function">collectResults</span><span class="token punctuation">(</span>futures<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆå¹¶ç»“æœ</span>
        <span class="token class-name">String</span> finalResult <span class="token operator">=</span> <span class="token function">mergeTranscriptionResults</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¹¶è¡Œå¤„ç†å®Œæˆï¼Œæ€»è€—æ—¶: {}msï¼Œç‰‡æ®µæ•°: {}ï¼Œç»“æœé•¿åº¦: {}å­—ç¬¦&quot;</span><span class="token punctuation">,</span>  endTime <span class="token operator">-</span> startTime<span class="token punctuation">,</span> segments<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> finalResult<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> finalResult<span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å¹¶è¡Œå¤„ç†éŸ³é¢‘æ–‡ä»¶å¤±è´¥ï¼Œå›é€€åˆ°å•çº¿ç¨‹å¤„ç†&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">audioTransactionSingle</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q2-è½¬å½•ç»“æœä¸ºç©º" tabindex="-1"><a class="header-anchor" href="#q2-è½¬å½•ç»“æœä¸ºç©º" aria-hidden="true">#</a> Q2ï¼šè½¬å½•ç»“æœä¸ºç©º</h3><p><strong>é—®é¢˜</strong>ï¼šéŸ³é¢‘æ–‡ä»¶æ ¼å¼ä¸è¢«æ”¯æŒã€‚</p><p><strong>è§£å†³</strong>ï¼šç¡®ä¿éŸ³é¢‘æ ¼å¼ä¸º MP3ã€WAV æˆ– M4Aï¼Œä¸”éŸ³é¢‘è´¨é‡æ¸…æ™°ã€‚</p><h3 id="q3-ç¿»è¯‘ç»“æœæœ—è¯»" tabindex="-1"><a class="header-anchor" href="#q3-ç¿»è¯‘ç»“æœæœ—è¯»" aria-hidden="true">#</a> Q3: ç¿»è¯‘ç»“æœæœ—è¯»</h3><p><strong>é—®é¢˜</strong>ï¼šç°åœ¨ç¿»è¯‘çš„ç»“æœæ˜¯ä»¥æ–‡å­—çš„æ–¹å¼è¿›è¡Œæ˜¾ç¤ºï¼Œæˆ‘å¸Œæœ›ä»¥è¯­éŸ³æ’­æŠ¥çš„æ–¹å¼æ¥å‘ˆç°</p><p><strong>è§£å†³</strong>ï¼šé¡¹ç›®åŸå‹ä¸­æä¾›äº†ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„è¯­éŸ³åˆæˆæ¥å®ç°ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©ä¸€äº›æ¨¡å‹å‚å®¶æä¾›çš„TTSæ¨¡å‹æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½</p><h2 id="å››ã€æµ‹è¯•å°ç»“" tabindex="-1"><a class="header-anchor" href="#å››ã€æµ‹è¯•å°ç»“" aria-hidden="true">#</a> å››ã€æµ‹è¯•å°ç»“</h2><p>å¯åŠ¨åº”ç”¨åï¼Œè®¿é—® <code>http://localhost:8080/translate</code>ï¼Œä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ï¼Œæ•´ä¸ªè¿‡ç¨‹å»¶è¿Ÿæ§åˆ¶åœ¨ç§’çº§ï¼Œä½“éªŒè¿˜æ˜¯æ¯”è¾ƒæµç•…çš„</p><figure><img src="https://imgbed.ppai.top/file/1772441431415_D06-3.gif" alt="D06-3.gif" tabindex="0" loading="lazy"><figcaption>D06-3.gif</figcaption></figure><p>é™¤äº†ä¸Šé¢çš„ä¼ è¾“éŸ³é¢‘ä¹‹å¤–ï¼Œè¿˜æ˜¯æ”¯æŒè¯­éŸ³å½•å…¥ç¿»è¯‘çš„ï¼Œå¦‚ä¸‹</p><figure><img src="https://imgbed.ppai.top/file/1772442648403_D06-4.gif" alt="D06-4.gif" tabindex="0" loading="lazy"><figcaption>D06-4.gif</figcaption></figure><p>æœ¬æ–‡ä¸­æ‰€æœ‰çš„æºç ï¼Œéƒ½å¯ä»¥åœ¨ä¸‹é¢ä»“åº“ä¸­è·å–</p>`,31),y={href:"https://github.com/liuyueyi/spring-ai-demo/tree/master/v2/T05-voice-chat-robot",target:"_blank",rel:"noopener noreferrer"},S=n("p",null,"æ•´ä½“å®ç°ä¸‹æ¥åŸºæœ¬ä¸Šæ²¡æœ‰å¤ªå¤§çš„éš¾åº¦ï¼Œå¯¹äºç†Ÿç»ƒè°ƒç”¨APIçš„å°ä¼™ä¼´ï¼Œä¼šæƒŠäººçš„å‘ç°ï¼Œè¿™AIåº”ç”¨çœ‹èµ·æ¥å’Œè°ƒæ¥å£æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«å•Šï¼Œä¸ºå•¥è¿˜ä¼šæœ‰ä¸“é—¨çš„å¤§æ¨¡å‹å¼€å‘å²—ï¼Ÿå’Œä¼ ç»Ÿçš„åç«¯å¼€æ”¾åˆ°åº•æœ‰å•¥ä¸ä¸€æ ·çš„ï¼Ÿå¦‚æœæœ‰æ­¤ç–‘é—®çš„è¯ï¼Œä¸å¦¨èŠ±ä¸ªå‡ åˆ†é’Ÿçœ‹çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œç›¸ä¿¡ä¼šæœ‰ä¸ä¸€æ ·çš„æ„Ÿè§¦ğŸ˜Š",-1),w=n("p",null,"é›¶åŸºç¡€å…¥é—¨ï¼š",-1),_={href:"https://mp.weixin.qq.com/s/qCn8x2XO2shA8MheYbHq0w",target:"_blank",rel:"noopener noreferrer"},x={href:"https://mp.weixin.qq.com/s/2GXBNOUq3jlysipftz8TpA",target:"_blank",rel:"noopener noreferrer"},I={href:"https://mp.weixin.qq.com/s/v-z6EHY300ElOxdGPdzc0w",target:"_blank",rel:"noopener noreferrer"},q={href:"https://mp.weixin.qq.com/s/t_BuAW9i0npcaJdua3Am2Q",target:"_blank",rel:"noopener noreferrer"},A={href:"https://mp.weixin.qq.com/s/vzt0bGwcfnASOiBa0Kc7VQ",target:"_blank",rel:"noopener noreferrer"},T={href:"https://mp.weixin.qq.com/s/Nk-N34TLJVCTI5F4k5rGaQ",target:"_blank",rel:"noopener noreferrer"},E={href:"https://mp.weixin.qq.com/s/ZQbztqBq7_PzynG06N4-mg",target:"_blank",rel:"noopener noreferrer"},M={href:"https://mp.weixin.qq.com/s/nnKspRO87xbrn4-LBV3RNA",target:"_blank",rel:"noopener noreferrer"},B={href:"https://mp.weixin.qq.com/s/_5D2tF6CPnafj5mlmlwLNw",target:"_blank",rel:"noopener noreferrer"},L={href:"https://mp.weixin.qq.com/s/z5qaLtjChsvjhWNs8Nw05Q",target:"_blank",rel:"noopener noreferrer"},D={href:"https://mp.weixin.qq.com/s/MFvE8ahSyIhMZIFeSI91kg",target:"_blank",rel:"noopener noreferrer"},P=n("hr",null,null,-1),G=n("p",null,"å®æˆ˜",-1),j={href:"https://mp.weixin.qq.com/s/96rHyp_gBUgmA2dhSbzNww",target:"_blank",rel:"noopener noreferrer"},O={href:"https://mp.weixin.qq.com/s/SnXdTB6tYqAzG7HgbnTSAQ",target:"_blank",rel:"noopener noreferrer"},U={href:"https://mp.weixin.qq.com/s/NHqLJbos-_nrxNNmhg7IBQ",target:"_blank",rel:"noopener noreferrer"},z={href:"https://mp.weixin.qq.com/s/ujxVleNhjxzUgL-rjfFcVA",target:"_blank",rel:"noopener noreferrer"},V={href:"https://mp.weixin.qq.com/s/LcvmiIERs6aOIlRAKGGnFg",target:"_blank",rel:"noopener noreferrer"},F={href:"https://mp.weixin.qq.com/s/QyuWZ4EZ32pbcWn3fVphHQ",target:"_blank",rel:"noopener noreferrer"};function Q(R,N){const t=o("ExternalLinkIcon"),e=o("Mermaid");return i(),l("div",null,[r,n("blockquote",null,[k,n("p",null,[s("æ³¨å†Œåœ°å€: "),n("a",d,[s("https://cloud.siliconflow.cn/i/ge3VpPHH"),a(t)])]),m]),v,a(e,{id:"mermaid-139",code:"eJx1kU1LAkEYx+99isXOQhGCdAjUXd+2m90GD1qzGSwVZkQ3jSgz25Qsi2TNUBA0PURari9fxplZv0XrjJtzaQ7DML/f/OeZZxT16Gw3EUumhB1xRbCGB5BSE2f70+/cdPg2q37O3otRwencErwWqeJsYWoYKFcLiVHqeynzAXNSQq+6zYjxgm7uSKvLJB+VRMD2kDEgrdtIRDInOtYaTBGpIgFU0ObK8AJ/NFD9khSuGKfTyWl8Pxk7TggO9NMza3kmOCibD4mG+AEr2xy10eiRHV/SAMBP17jSJhPD7BYZhYd7y0v8VAsCrDVn6QwLIcYD1itMDlAeAvgrg4b3zOLDQpSHASsOdfJWz7g3BCmW7V50dFzu4ecxqQ/44zJdh7k1nWS6sb34I1Pro3EZV9LEyPIVsl6lzlUoeATlQFU3V+G64lIgB7wLoGxAl+LigGQDxUJrHPDbUW7FBd0cCPwH5L8oGIdw5RezNfY+"}),g,a(e,{id:"mermaid-207",code:"eJx9VttOI0cQfc9XtHhylGACuaNoJTAQoYQEZXD2eRY3MIrtccZtUBRFMoSLuSz2CpZLuBhYWByx2E4Il7UB/4y7Z/wXqZmasWds7/oBIfeprlOnTlU7Tn9N0Og4HVDkSU2OfEDgE5M1powrMTnKSJDIcaJv5kTq1heMU+3DFkS/iRDXaeM8xXdzvn5NnWmLexowgU/ps58VOhNQo0xTw2GqteD6xixgX4KpY5ocjYdlRt8LlxAeUhAvjzNFjUpUm1bGaQtcGjLRkhJWxtXoUFidIX2jwy2owIiJCkzJbEQN0bB1bv35QWWUqNNUI8GPpaFeW5nq3Ur1/qiWvaqdvBBbS9XyDd8vid1CIy7Y+eRJfy/p9hOxvMHvk3qlbBRe1I6vawcnvi7m1Imq9QMYVOglPX7y7eAY6ZJBiwaIYJhRuBX/zFkBAO7EBJ/6iVHZ5HuHpA73T7FI2I5pIfSZn9SSy2L1bzd5kdoCivx8lT+8hO8bhWvK5BQj6gSBSKycpwvV8hle0fvNM63rSSdBNfjtv2J/2X2tc/xQgdha6TVfWK29Wuf5Q7F948rkleBzPxn9UXI0SMTCqhyyem3d5oskwgxaprGuCVWLdIZkJqOGXr7WVWL9TGzeeLqUnhMviw7vCSVMe0kbxkzWJin7Xo5OJuRJgOh7eXG0ZBQujVyyQdlsgk36Cz/IkxWpDN8sVO+S1XKZrxwPD/iCweEBpOcCf+knPLXHyyXH7eDeMTn+i5EvgirN6K8AfbnD53I8VWSAGpFjfHEBvhI7R7w476WDPf667onfzYjhUC/pSCSUUGecaUp0suMPr+ymTT+BLNlStbSOAUBOv1iVpEGjcggqejvUDaZuuBSE+onGoSsS06gc6bJTunK4iukGg2M1UpwORhTGqAZ1Ufwv7iqpUU03WLxaORBrs3U+YFax+dhuSK0s/H5OXJ7x03k9s4i+bkDBOoS/vTGO1/Acu288vHGkdzOWIDsMjFH8EwwsNy0cn2kfbC7GSBBjrojuuoWnu0EjiMJRHteUmBkYRye7fUc+IiJ3zA9X0aCNW6UhUwVkAibDtiJbiBT7b/Tyhjjc97Coiw1GswMKizx1wTPr+l/zGGZaKP+2HtZSuRkOztMvl/njQkN3yxZ1cFhVY82Q+mHTbeJVUmTPnEb7YRczWYnGv6O/+dAwjZrfMc3GQ94onGA6vvxcvyi0c6n5odHQuyoz/QTjATFiPVdLzqKUKKLVFjpNowzmxdOxDuvI3DVwgmI2Kdlh5ZGjIY+5cOk3UQiMwJ6HeUNXmU9OIKxAUnE9y+/TGGLlG9XUSIzxtQWeuXBWln5V1stZkc7opyWj8Nz+VpQySMZBNe8r8xMYcZKbjxIms3YWpmwyEvbWOkGs8bjBl0qeJlk34rsFc42C2pctL4n8dRsvgP49MM91/d25W/XH3ehR36aE3reyoPTNfXdxgwnGKJ5fg3KrlWOevm31RQ+MbYMXMDrIItTDC3J4+DAtQZGBk71pI8HNtlutd0/sPELr0B5GZY+XXrcs4x4YdBu895/YKgaHMcjxgHtluZQDG7gchLa0D2w3rtyI5GzbvdwDq0LcLQAIny7jeh485bzfZetVgIdHPy/Xdk8R0jh0hhpPcRadxAtXte1L74S2/Kyq/7Yw1m/547bYT+rllG3H/wGekInj"}),b,n("blockquote",null,[n("p",null,[s("å¯¹äºSpringAIå¦‚ä½•ä½¿ç”¨éŸ³é¢‘æ¨¡å‹çš„ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹ - "),n("a",h,[s("18.è¯­éŸ³æ¨¡å‹ä¹‹è¯­éŸ³è¯†åˆ« | Helllo LLM Guides"),a(t)])])]),f,n("ul",null,[n("li",null,[n("a",y,[s("https://github.com/liuyueyi/spring-ai-demo/tree/master/v2/T05-voice-chat-robot"),a(t)])])]),S,w,n("ul",null,[n("li",null,[n("a",_,[s("LLM åº”ç”¨å¼€å‘æ˜¯ä»€ä¹ˆï¼šé›¶åŸºç¡€ä¹Ÿå¯ä»¥è¯»æ‡‚çš„ç§‘æ™®æ–‡(æç®€ç‰ˆ)"),a(t)])]),n("li",null,[n("a",x,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šåº-ä¸ºä»€ä¹ˆä½ â€œä¼šç”¨ LLMâ€ï¼Œä½†åšä¸å‡ºå¤æ‚åº”ç”¨ï¼Ÿ"),a(t)])]),n("li",null,[n("a",I,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¸€ç«  LLMåˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ"),a(t)])]),n("li",null,[n("a",q,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬äºŒç«  æ¨¡å‹ä¸æ˜¯é‡ç‚¹ï¼Œå‚æ•°æ‰æ˜¯ä½ çœŸæ­£çš„æ§åˆ¶é¢æ¿"),a(t)])]),n("li",null,[n("a",A,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¸‰ç«  ä¸ºä»€ä¹ˆæˆ‘çš„Promptè¡¨ç°å¾ˆç³Ÿï¼Ÿ"),a(t)])]),n("li",null,[n("a",T,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬å››ç«  Prompt çš„å·¥ç¨‹åŒ–ç»“æ„è®¾è®¡"),a(t)])]),n("li",null,[n("a",E,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬äº”ç«  ä» Prompt åˆ° Prompt æ¨¡æ¿ä¸å·¥ç¨‹æ²»ç†"),a(t)])]),n("li",null,[n("a",M,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬å…­ç«  ä¸Šä¸‹æ–‡çª—å£çš„çœŸå®è¾¹ç•Œ"),a(t)])]),n("li",null,[n("a",B,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¸ƒç«  ä» â€œå †ä¸Šä¸‹æ–‡â€ åˆ° â€œç®¡ç†ä¸Šä¸‹æ–‡â€"),a(t)])]),n("li",null,[n("a",L,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬å…«ç«  è®°å¿†ç­–ç•¥çš„å·¥ç¨‹åŒ–é€‰æ‹©"),a(t)])]),n("li",null,[n("a",D,[s("å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¹ç«  ä¸Šä¸‹æ–‡å·¥ç¨‹åœ¨ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹ä¸­çš„è½åœ°"),a(t)])])]),P,G,n("ul",null,[n("li",null,[n("a",j,[s("å®æˆ˜ | ä¸¤ç™¾è¡Œå®ç°ä¸€ä¸ªè‡ªç„¶è¯­è¨€åœ°å€æå–æ™ºèƒ½ä½“"),a(t)])]),n("li",null,[n("a",O,[s("å®æˆ˜ | åŸºäºSpringAIä¸å¤§æ¨¡å‹çš„é›¶é…ç½®å‘ç¥¨æ™ºèƒ½æå–æ¶æ„"),a(t)])]),n("li",null,[n("a",U,[s("å®æˆ˜ | é›¶åŸºç¡€æ­å»ºçŸ¥è¯†åº“é—®ç­”æœºå™¨äººï¼šåŸºäºSpringAI+RAGçš„å®Œæ•´å®ç°"),a(t)])]),n("li",null,[n("a",z,[s("å‘Šåˆ«ä¼ ç»ŸAIå¼€å‘ï¼SpringAI Agent + Skillsé‡æ–°å®šä¹‰æ™ºèƒ½åº”ç”¨"),a(t)])]),n("li",null,[n("a",V,[s("Spring AIä¸­çš„å¤šè½®å¯¹è¯è‰ºæœ¯ï¼šè®©å¤§æ¨¡å‹ä¸»åŠ¨æé—®è·å–æ˜ç¡®éœ€æ±‚"),a(t)])]),n("li",null,[n("a",F,[s("å®æˆ˜ | æˆ‘ç”¨SpringAIé€ äº†ä¸ªã€Œå¾®ä¿¡çº¢åŒ…å°é¢è®¾è®¡å¸ˆã€"),a(t)])])])])}const H=c(u,[["render",Q],["__file","D06.æ‰‹æŠŠæ‰‹æ­å»ºå®æ—¶è¯­éŸ³ç¿»è¯‘æœºå™¨äºº.html.vue"]]);export{H as default};
