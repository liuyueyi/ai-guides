import{_ as c,V as i,W as l,Y as n,a0 as s,Z as a,$ as u,X as e,F as p}from"./framework-2236aa4f.js";const r={},k=n("h1",{id:"_18-è¯­éŸ³æ¨¡å‹ä¹‹è¯­éŸ³è¯†åˆ«",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_18-è¯­éŸ³æ¨¡å‹ä¹‹è¯­éŸ³è¯†åˆ«","aria-hidden":"true"},"#"),s(" 18.è¯­éŸ³æ¨¡å‹ä¹‹è¯­éŸ³è¯†åˆ«")],-1),d=n("p",null,"ç°åœ¨çš„å¤§æ¨¡å‹åº”ç”¨ä¸­ï¼Œè¯­éŸ³è¾“å…¥æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„åœºæ™¯ï¼Œå› æ­¤è¯­éŸ³è¯†åˆ«å°±æ˜¯ä¸€ä¸ªå¾ˆåŸºç¡€çš„è¦æ±‚äº†ï¼›å½“ç„¶åœ¨æ²¡æœ‰å¤§æ¨¡å‹çš„æ—¶ä»£ï¼Œè¯­éŸ³è¯†åˆ«ä¹Ÿä¸ç®—å°‘è§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•ä½¿ç”¨SpringAIæ¥å®ç°è¯­éŸ³è¯†åˆ«",-1),v={href:"https://cloud.siliconflow.cn/me/models?types=speech",target:"_blank",rel:"noopener noreferrer"},m=n("h2",{id:"ä¸€ã€å®ä¾‹æ¼”ç¤º",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ä¸€ã€å®ä¾‹æ¼”ç¤º","aria-hidden":"true"},"#"),s(" ä¸€ã€å®ä¾‹æ¼”ç¤º")],-1),b=e(`<h3 id="_1-åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-åˆå§‹åŒ–" aria-hidden="true">#</a> 1. åˆå§‹åŒ–</h3><p>æˆ‘ä»¬å€ŸåŠ©OpenAIçš„æ¥å£é£æ ¼æ¥å®Œæˆè¯­éŸ³è¯†åˆ«æ¥å…¥ï¼Œå› æ­¤éœ€è¦å¼•å…¥å¯¹åº”çš„ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.ai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-ai-starter-model-openai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æ¨¡å‹ç›¸å…³çš„é…ç½®ï¼Œ å¯¹åº”çš„ <code>application.yml</code> å†…å®¹å¦‚ä¸‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>spring<span class="token operator">:</span>
  ai<span class="token operator">:</span>
    openai<span class="token operator">:</span>
      # api<span class="token operator">-</span>key ä½¿ç”¨ä½ è‡ªå·±ç”³è¯·çš„è¿›è¡Œæ›¿æ¢ï¼›å¦‚æœä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°è¿›è¡Œè®¾ç½®
      api<span class="token operator">-</span>key<span class="token operator">:</span> $<span class="token punctuation">{</span>silicon<span class="token operator">-</span>api<span class="token operator">-</span>key<span class="token punctuation">}</span>
      transcription<span class="token operator">:</span>
        api<span class="token operator">-</span>key<span class="token operator">:</span> $<span class="token punctuation">{</span>silicon<span class="token operator">-</span>api<span class="token operator">-</span>key<span class="token punctuation">}</span>
        base<span class="token operator">-</span>url<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>api<span class="token punctuation">.</span>siliconflow<span class="token punctuation">.</span>cn<span class="token operator">/</span>v1
        transcription<span class="token operator">-</span>path<span class="token operator">:</span> <span class="token operator">/</span>audio<span class="token operator">/</span>transcriptions
        options<span class="token operator">:</span>
          model<span class="token operator">:</span> <span class="token class-name">FunAudioLLM</span><span class="token operator">/</span><span class="token class-name">SenseVoiceSmall</span>
          response<span class="token operator">-</span>format<span class="token operator">:</span> text
      chat<span class="token operator">:</span> # èŠå¤©æ¨¡å‹
        options<span class="token operator">:</span>
          model<span class="token operator">:</span> deepseek<span class="token operator">-</span>ai<span class="token operator">/</span><span class="token class-name">DeepSeek</span><span class="token operator">-</span><span class="token constant">R1</span><span class="token operator">-</span><span class="token number">0528</span><span class="token operator">-</span><span class="token class-name">Qwen3</span><span class="token operator">-</span><span class="token number">8</span>B
      base<span class="token operator">-</span>url<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>api<span class="token punctuation">.</span>siliconflow<span class="token punctuation">.</span>cn

# ä¿®æ”¹æ—¥å¿—çº§åˆ«
logging<span class="token operator">:</span>
  level<span class="token operator">:</span>
    <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ai<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>client<span class="token punctuation">.</span>advisor<span class="token punctuation">.</span></span>SimpleLoggerAdvisor</span><span class="token operator">:</span> debug
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),g={href:"https://github.com/liuyueyi/spring-ai-demo/blob/master/S19-audio-transaction/src/main/resources/",target:"_blank",rel:"noopener noreferrer"},f=e(`<h3 id="_2-æµ‹è¯•ç«¯ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-æµ‹è¯•ç«¯ç‚¹" aria-hidden="true">#</a> 2. æµ‹è¯•ç«¯ç‚¹</h3><p>ç„¶ååˆ›å»ºä¸€ä¸ª <code>Controller</code> ç”¨äºæµ‹è¯•ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨æ³¨å…¥çš„ <code>TranscriptionModel</code> æ¥è¿›è¡Œè¯­éŸ³æ¨¡å‹çš„äº¤äº’</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AudioTransactionController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span>LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">AudioTransactionController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * ç›´æ¥ä½¿ç”¨é»˜è®¤æ³¨å†Œçš„æ¨¡å‹å¯¹è±¡æ¥è¿›è¡Œäº¤äº’
     */</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TranscriptionModel</span> initTranscriptionModel<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/test.mp3&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-è·å–è¯­éŸ³è¯†åˆ«å†…å®¹" tabindex="-1"><a class="header-anchor" href="#_3-è·å–è¯­éŸ³è¯†åˆ«å†…å®¹" aria-hidden="true">#</a> 3. è·å–è¯­éŸ³è¯†åˆ«å†…å®¹</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>transcriptionModel</code>æ¥è¿›è¡Œå¤§æ¨¡å‹çš„äº¤äº’ï¼Œçœ‹çœ‹è¯­éŸ³è¯†åˆ«æ•ˆæœ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ä½¿ç”¨OpenAIé£æ ¼çš„è¯­è¨€è¯†åˆ«
 *
 * <span class="token keyword">@return</span>
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;translateAudio&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">translateAudio</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">AudioTranscriptionOptions</span> options <span class="token operator">=</span> <span class="token class-name">OpenAiAudioTranscriptionOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;TeleAI/TeleSpeechASR&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">responseFormat</span><span class="token punctuation">(</span><span class="token class-name">OpenAiAudioApi<span class="token punctuation">.</span>TranscriptResponseFormat</span><span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AudioTranscriptionPrompt</span> prompt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioTranscriptionPrompt</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AudioTranscriptionResponse</span> response <span class="token operator">=</span> initTranscriptionModel<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;response -&gt; {}&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ•´ä½“çš„ä½¿ç”¨æ–¹å¼å’Œæ–‡æœ¬æ¨¡å‹å¤§å·®ä¸å·®ï¼Œä½¿ç”¨ éŸ³é¢‘æ–‡ä»¶ + <code>AudioTranscriptionOptions</code> æ¥æ„å»ºæç¤ºè¯ <code>AudioTranscriptionPrompt</code>ï¼Œç„¶åç›´æ¥é€šè¿‡ <code>model.call()</code> è¿›è¡Œå¤§æ¨¡å‹è°ƒç”¨ï¼Œè·å–è¿”å›ç»“æœ</p><p>å¯¹äº <code>AudioTranscriptionOptions</code> å¯ä»¥è®¾ç½®è¯­éŸ³ã€æ¸©åº¦ã€æ¨¡å‹ã€è¿”å›æ ¼å¼ç­‰å„ç§å‚æ•°ï¼ˆå½“ç„¶ä¸åŒçš„æ¨¡å‹å‚å®¶æ”¯æŒæƒ…å†µå¹¶ä¸ä¸€æ ·ï¼‰</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥è®¿é—®è¿™ä¸ªç«¯ç‚¹ï¼Œçœ‹ä¸‹è¯†åˆ«æƒ…å†µ</p><figure><img src="https://imgbed.ppai.top/file/1772162533716_18-1.webp" alt="18-1.webp" tabindex="0" loading="lazy"><figcaption>18-1.webp</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ä¸­è‹±æ–‡çš„éŸ³é¢‘éƒ½è¢«æ­£ç¡®çš„è¯†åˆ«å‡ºæ¥äº†</p><h3 id="_4-æ‰‹åŠ¨åˆå§‹åŒ–model" tabindex="-1"><a class="header-anchor" href="#_4-æ‰‹åŠ¨åˆå§‹åŒ–model" aria-hidden="true">#</a> 4. æ‰‹åŠ¨åˆå§‹åŒ–Model</h3><p>å‰é¢ä½¿ç”¨åˆ°çš„æ˜¯OpenAI starterè‡ªåŠ¨æ³¨å…¥çš„<code>TranscriptionModel</code>ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>OpenAiAudioApi</code>æ¥æ‰‹åŠ¨å®ç°ä¸€ä¸ª<code>TranscriptionModel</code></p><p>æ¥ä¸‹æ¥çœ‹çœ‹å…·ä½“çš„å®ç°æ–¹å¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">AudioTransactionController</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">OpenAiAudioApi</span> openAiAudioApi <span class="token operator">=</span> <span class="token class-name">OpenAiAudioApi</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">apiKey</span><span class="token punctuation">(</span><span class="token function">getApiKey</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> <span class="token string">&quot;silicon-api-key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.siliconflow.cn&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    transcriptionModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpenAiAudioTranscriptionModel</span><span class="token punctuation">(</span>openAiAudioApi<span class="token punctuation">,</span>
            <span class="token class-name">OpenAiAudioTranscriptionOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;TeleAI/TeleSpeechASR&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getApiKey</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. é€šè¿‡ --silicon-api-key å¯åŠ¨å‘½ä»¤ä¼ å‚</span>
    <span class="token class-name">String</span> val <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2. é€šè¿‡jvmä¼ å‚ -Dsilicon-api-key=</span>
        val <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 3. é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å‚</span>
            val <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çœ‹äº†ä¸Šé¢åŸºäº <code>OpenAiAudioApi</code> åˆ›å»º <code>TranscriptionModel</code> çš„æ–¹å¼ï¼Œæˆ‘ä»¬ä¼šæƒŠå¥‡çš„å‘ç°ï¼Œè¿™ç§å®ç°å’Œå‰é¢ä»‹ç»çš„OpenAIé£æ ¼çš„åˆ›å»ºå¯¹è¯æ¨¡å‹çš„æ–¹å¼ç®€ç›´æ˜¯é›·åŒäº†ï¼ˆè¿™æ ·æŒºå¥½çš„ï¼Œå‡å°‘äº†æˆ‘ä»¬çš„å­¦ä¹ æˆæœ¬ğŸ˜Šï¼‰</p><p>æ¥ä¸‹æ¥å†™ä¸ªdemoéªŒè¯ä¸‹æ•ˆæœå¦‚ä½•(å…·ä½“çš„ä½¿ç”¨æ–¹å¼å’Œå‰é¢å¹¶æ²¡æœ‰åŒºåˆ«)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;translateAudioV2&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">translateAudioV2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">AudioTranscriptionOptions</span> options <span class="token operator">=</span> <span class="token class-name">OpenAiAudioTranscriptionOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">responseFormat</span><span class="token punctuation">(</span><span class="token class-name">OpenAiAudioApi<span class="token punctuation">.</span>TranscriptResponseFormat</span><span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;FunAudioLLM/SenseVoiceSmall&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">language</span><span class="token punctuation">(</span><span class="token string">&quot;zh&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AudioTranscriptionPrompt</span> prompt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioTranscriptionPrompt</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AudioTranscriptionResponse</span> response <span class="token operator">=</span> transcriptionModel<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;response -&gt; {}&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-è¸©å‘è®°å½•" tabindex="-1"><a class="header-anchor" href="#_5-è¸©å‘è®°å½•" aria-hidden="true">#</a> 5. è¸©å‘è®°å½•</h3><p>æ•´ä½“çš„éŸ³é¢‘æ¨¡å‹çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æˆ‘åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™å‘ç°äº†å‡ ä¸ªè›‹ç–¼çš„é—®é¢˜</p><p>ç°åœ¨çš„ <code>1.1.2</code> ç‰ˆæœ¬ä¸­ï¼Œåªæ”¯æŒé…ç½® base-urlï¼Œå¯¹åº”çš„è¯­éŸ³æ˜¯è¢«çš„pathè·¯å¾„åœ¨ä»£ç ä¸­å†™æ­»çš„ä¸º<code>/v1/audio/translations</code></p><figure><img src="https://imgbed.ppai.top/file/1772163049647_18-2.webp" alt="18-2.webp" tabindex="0" loading="lazy"><figcaption>18-2.webp</figcaption></figure><blockquote><p>æ³¨ï¼šå³ä¾¿ä½ çš„å¤§æ¨¡å‹æ”¯æŒopenStyleçš„æ¥å£é£æ ¼ï¼Œä½†æ˜¯è‹¥pathè·¯å¾„ä¸ä¸€è‡´ï¼Œé‚£ä¹Ÿæ˜¯æ— æ³•ä½¿ç”¨ openai-starter çš„</p><p>è¿™ä¸ªé—®é¢˜åœ¨ <code>SpringAI ~ 2.0.0-M2</code> å¾—åˆ°äº†è§£å†³ï¼Œå¦‚ä¸‹å›¾ <img src="https://imgbed.ppai.top/file/1772163253350_18-3.webp" alt="18-3.webp" loading="lazy"></p></blockquote><hr><p>ç¬¬äºŒä¸ªè¸©å‘ç‚¹å°±æ˜¯ä½¿ç”¨OpenAIçš„startè¿›è¡Œè¯­éŸ³è¯†åˆ«æ—¶ï¼Œå¤§æ¨¡å‹çš„æœåŠ¡ç«¯ä¸€ç›´è¿”å›å¼‚å¸¸ <code>{&quot;detail&quot;:[{&quot;type&quot;:&quot;missing&quot;,&quot;loc&quot;:[&quot;body&quot;,&quot;file&quot;],&quot;msg&quot;:&quot;Field required&quot;,&quot;input&quot;:null}]}</code></p><figure><img src="https://imgbed.ppai.top/file/1772163689795_18-4.webp" alt="18-4.webp" tabindex="0" loading="lazy"><figcaption>18-4.webp</figcaption></figure><p>éŸ³é¢‘æ–‡ä»¶æ˜æ˜ä¸Šä¼ äº†ï¼Œä¸ºä»€ä¹ˆæ¨¡å‹ç«¯æç¤ºæ²¡æœ‰å‘¢ï¼Ÿ</p><p>ä¸»è¦çš„åŸå› æ˜¯é»˜è®¤çš„ RestClient å…¶åº•å±‚ Client ä¸æ˜¯ JDK HttpClientï¼Œè€Œæ˜¯æŸä¸ªä¸æ”¯æŒ multipart çš„å®ç°ï¼Œä»è€Œåˆ°è¿™äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯¹åº”çš„è§£å†³æ–¹å¼å°±æ˜¯å¼ºåˆ¶æŒ‡å®š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">RestClient</span> restClient <span class="token operator">=</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">requestFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JdkClientHttpRequestFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ä½ ä¼šåœ¨é¡¹ç›®æºç çš„ Application ä¸­çœ‹åˆ° <code>RestClient.Builder</code> çš„æ³¨å†Œï¼Œå°±æ˜¯ä¸ºäº†è§£å†³ä¸Šé¢è¿™ä¸ªé—®é¢˜è€Œå‡ºç°çš„</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">S19Application</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">S19Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨æˆåŠŸï¼Œå‰ç«¯æµ‹è¯•è®¿é—®åœ°å€ï¼š http://localhost:8080/translateAudio&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestClient<span class="token punctuation">.</span>Builder</span> <span class="token function">restClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// è‹¥åº•å±‚ Client ä¸æ˜¯ JDK HttpClientï¼Œè€Œæ˜¯æŸä¸ªä¸æ”¯æŒ multipart çš„å®ç°,ä»è€Œå¯¼è‡´éŸ³é¢‘ä¸Šä¼ æ— æ³•è¢«æ­£ç¡®è§£æï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸€è¡Œæ¥è°ƒæ•´åº•å±‚çš„ Client</span>
                <span class="token punctuation">.</span><span class="token function">requestFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JdkClientHttpRequestFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">messageConverters</span><span class="token punctuation">(</span>converters <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    converters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FormHttpMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    converters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResourceHttpMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    converters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringHttpMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äºŒã€å°ç»“" tabindex="-1"><a class="header-anchor" href="#äºŒã€å°ç»“" aria-hidden="true">#</a> äºŒã€å°ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº†è¯­éŸ³å¤§æ¨¡å‹çš„ä½¿ç”¨æ–¹å¼ï¼Œç›®å‰spring-aiå®˜æ–¹ä¹Ÿåªé’ˆå¯¹OpenAIè¿›è¡Œçš„æ”¯æ’‘ï¼Œä¸åŒçš„å‚å•†çš„è¯­éŸ³æ¨¡å‹å¯èƒ½ä¼šæœ‰è‡ªå·±çš„ç‰¹å®šäº¤äº’æ–¹å¼ï¼Œå¤§å®¶åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„ç”„åˆ«</p>`,33),h={href:"https://github.com/liuyueyi/spring-ai-demo/tree/master/S19-audio-transaction",target:"_blank",rel:"noopener noreferrer"};function A(y,w){const t=p("ExternalLinkIcon"),o=p("RouterLink");return i(),l("div",null,[k,d,n("p",null,[s("ä¸‹é¢çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬å°†åŸºäº "),n("a",v,[s("ç¡…åŸºæµåŠ¨"),a(t)]),s(" çš„å…è´¹è¯­éŸ³è¯†åˆ«æ¨¡å‹æ¥å®Œæˆ")]),m,n("p",null,[s("é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªSpringAIçš„é¡¹ç›®ï¼ŒåŸºæœ¬æµç¨‹åŒ "),a(o,{to:"/ai-dev/%E5%9F%BA%E7%A1%80%E7%AF%87/01.%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AASpringAI-Demo%E5%B7%A5%E7%A8%8B.html"},{default:u(()=>[s("åˆ›å»ºä¸€ä¸ªSpringAI-Demoå·¥ç¨‹")]),_:1})]),b,n("p",null,[s("ç„¶ååœ¨èµ„æºç›®å½•(resources)ä¸‹ï¼Œå‡†å¤‡ä¸€ä¸ªç”¨äºæµ‹è¯•çš„éŸ³é¢‘æ–‡ä»¶ "),n("a",g,[s("test.mp3"),a(t)])]),f,n("p",null,[s("æœ¬æ–‡å¯¹åº”çš„é¡¹ç›®æºç ä¸ºï¼š "),n("a",h,[s("S19-audio-transaction"),a(t)])])])}const q=c(r,[["render",A],["__file","18.è¯­éŸ³æ¨¡å‹ä¹‹è¯­éŸ³è¯†åˆ«.html.vue"]]);export{q as default};
