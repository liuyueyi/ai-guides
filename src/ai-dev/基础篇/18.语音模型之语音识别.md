---
order: 18
title: 18.è¯­éŸ³æ¨¡å‹ä¹‹è¯­éŸ³è¯†åˆ«
tag:
  - Spring
  - SpringAI
category:
  - SpringAI
date: 2026-02-27 11:24:07
keywords: SpringAI
---


# 18.è¯­éŸ³æ¨¡å‹ä¹‹è¯­éŸ³è¯†åˆ«

ç°åœ¨çš„å¤§æ¨¡å‹åº”ç”¨ä¸­ï¼Œè¯­éŸ³è¾“å…¥æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„åœºæ™¯ï¼Œå› æ­¤è¯­éŸ³è¯†åˆ«å°±æ˜¯ä¸€ä¸ªå¾ˆåŸºç¡€çš„è¦æ±‚äº†ï¼›å½“ç„¶åœ¨æ²¡æœ‰å¤§æ¨¡å‹çš„æ—¶ä»£ï¼Œè¯­éŸ³è¯†åˆ«ä¹Ÿä¸ç®—å°‘è§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•ä½¿ç”¨SpringAIæ¥å®ç°è¯­éŸ³è¯†åˆ«

ä¸‹é¢çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬å°†åŸºäº [ç¡…åŸºæµåŠ¨](https://cloud.siliconflow.cn/me/models?types=speech) çš„å…è´¹è¯­éŸ³è¯†åˆ«æ¨¡å‹æ¥å®Œæˆ


## ä¸€ã€å®ä¾‹æ¼”ç¤º

é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªSpringAIçš„é¡¹ç›®ï¼ŒåŸºæœ¬æµç¨‹åŒ [åˆ›å»ºä¸€ä¸ªSpringAI-Demoå·¥ç¨‹](01.åˆ›å»ºä¸€ä¸ªSpringAI-Demoå·¥ç¨‹.md)

### 1. åˆå§‹åŒ–

æˆ‘ä»¬å€ŸåŠ©OpenAIçš„æ¥å£é£æ ¼æ¥å®Œæˆè¯­éŸ³è¯†åˆ«æ¥å…¥ï¼Œå› æ­¤éœ€è¦å¼•å…¥å¯¹åº”çš„ä¾èµ–ï¼š

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-starter-model-openai</artifactId>
    </dependency>
</dependencies>
```


åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æ¨¡å‹ç›¸å…³çš„é…ç½®ï¼Œ å¯¹åº”çš„ `application.yml` å†…å®¹å¦‚ä¸‹

```java
spring:
  ai:
    openai:
      # api-key ä½¿ç”¨ä½ è‡ªå·±ç”³è¯·çš„è¿›è¡Œæ›¿æ¢ï¼›å¦‚æœä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°è¿›è¡Œè®¾ç½®
      api-key: ${silicon-api-key}
      transcription:
        api-key: ${silicon-api-key}
        base-url: https://api.siliconflow.cn/v1
        transcription-path: /audio/transcriptions
        options:
          model: FunAudioLLM/SenseVoiceSmall
          response-format: text
      chat: # èŠå¤©æ¨¡å‹
        options:
          model: deepseek-ai/DeepSeek-R1-0528-Qwen3-8B
      base-url: https://api.siliconflow.cn

# ä¿®æ”¹æ—¥å¿—çº§åˆ«
logging:
  level:
    org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor: debug
```

ç„¶ååœ¨èµ„æºç›®å½•(resources)ä¸‹ï¼Œå‡†å¤‡ä¸€ä¸ªç”¨äºæµ‹è¯•çš„éŸ³é¢‘æ–‡ä»¶ [test.mp3](https://github.com/liuyueyi/spring-ai-demo/blob/master/S19-audio-transaction/src/main/resources/)


### 2. æµ‹è¯•ç«¯ç‚¹

ç„¶ååˆ›å»ºä¸€ä¸ª `Controller` ç”¨äºæµ‹è¯•ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨æ³¨å…¥çš„ `TranscriptionModel` æ¥è¿›è¡Œè¯­éŸ³æ¨¡å‹çš„äº¤äº’

```java
@RestController
public class AudioTransactionController {
    private Logger log = org.slf4j.LoggerFactory.getLogger(AudioTransactionController.class);

    /**
     * ç›´æ¥ä½¿ç”¨é»˜è®¤æ³¨å†Œçš„æ¨¡å‹å¯¹è±¡æ¥è¿›è¡Œäº¤äº’
     */
    @Autowired
    private TranscriptionModel initTranscriptionModel;


    @Value("classpath:/test.mp3")
    private Resource resource;
}

```


### 3. è·å–è¯­éŸ³è¯†åˆ«å†…å®¹

æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨`transcriptionModel`æ¥è¿›è¡Œå¤§æ¨¡å‹çš„äº¤äº’ï¼Œçœ‹çœ‹è¯­éŸ³è¯†åˆ«æ•ˆæœ

```java
/**
 * ä½¿ç”¨OpenAIé£æ ¼çš„è¯­è¨€è¯†åˆ«
 *
 * @return
 * @throws IOException
 */
@GetMapping(path = "translateAudio")
@ResponseBody
public Object translateAudio() throws IOException {
    AudioTranscriptionOptions options = OpenAiAudioTranscriptionOptions.builder()
            .model("TeleAI/TeleSpeechASR")
            .responseFormat(OpenAiAudioApi.TranscriptResponseFormat.TEXT)
            .build();
    AudioTranscriptionPrompt prompt = new AudioTranscriptionPrompt(resource, options);
    AudioTranscriptionResponse response = initTranscriptionModel.call(prompt);
    log.info("response -> {}", response);
    return response.getResult().getOutput();
}
```

æ•´ä½“çš„ä½¿ç”¨æ–¹å¼å’Œæ–‡æœ¬æ¨¡å‹å¤§å·®ä¸å·®ï¼Œä½¿ç”¨ éŸ³é¢‘æ–‡ä»¶ + `AudioTranscriptionOptions` æ¥æ„å»ºæç¤ºè¯ `AudioTranscriptionPrompt`ï¼Œç„¶åç›´æ¥é€šè¿‡ `model.call()` è¿›è¡Œå¤§æ¨¡å‹è°ƒç”¨ï¼Œè·å–è¿”å›ç»“æœ

å¯¹äº `AudioTranscriptionOptions` å¯ä»¥è®¾ç½®è¯­éŸ³ã€æ¸©åº¦ã€æ¨¡å‹ã€è¿”å›æ ¼å¼ç­‰å„ç§å‚æ•°ï¼ˆå½“ç„¶ä¸åŒçš„æ¨¡å‹å‚å®¶æ”¯æŒæƒ…å†µå¹¶ä¸ä¸€æ ·ï¼‰

æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥è®¿é—®è¿™ä¸ªç«¯ç‚¹ï¼Œçœ‹ä¸‹è¯†åˆ«æƒ…å†µ

![18-1.webp](https://imgbed.ppai.top/file/1772162533716_18-1.webp)


å¯ä»¥çœ‹åˆ°ä¸­è‹±æ–‡çš„éŸ³é¢‘éƒ½è¢«æ­£ç¡®çš„è¯†åˆ«å‡ºæ¥äº†

### 4. æ‰‹åŠ¨åˆå§‹åŒ–Model

å‰é¢ä½¿ç”¨åˆ°çš„æ˜¯OpenAI starterè‡ªåŠ¨æ³¨å…¥çš„`TranscriptionModel`ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡`OpenAiAudioApi`æ¥æ‰‹åŠ¨å®ç°ä¸€ä¸ª`TranscriptionModel`

æ¥ä¸‹æ¥çœ‹çœ‹å…·ä½“çš„å®ç°æ–¹å¼

```java
public AudioTransactionController(Environment environment) {
    OpenAiAudioApi openAiAudioApi = OpenAiAudioApi.builder()
            .apiKey(getApiKey(environment, "silicon-api-key"))
            .baseUrl("https://api.siliconflow.cn")
            .build();

    transcriptionModel = new OpenAiAudioTranscriptionModel(openAiAudioApi,
            OpenAiAudioTranscriptionOptions.builder().model("TeleAI/TeleSpeechASR").build());
}

private String getApiKey(Environment environment, String key) {
    // 1. é€šè¿‡ --silicon-api-key å¯åŠ¨å‘½ä»¤ä¼ å‚
    String val = environment.getProperty(key);
    if (StringUtils.isBlank(val)) {
        // 2. é€šè¿‡jvmä¼ å‚ -Dsilicon-api-key=
        val = System.getProperty(key);
        if (val == null) {
            // 3. é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å‚
            val = System.getenv(key);
        }
    }
    return val;
}
```

çœ‹äº†ä¸Šé¢åŸºäº `OpenAiAudioApi` åˆ›å»º `TranscriptionModel` çš„æ–¹å¼ï¼Œæˆ‘ä»¬ä¼šæƒŠå¥‡çš„å‘ç°ï¼Œè¿™ç§å®ç°å’Œå‰é¢ä»‹ç»çš„OpenAIé£æ ¼çš„åˆ›å»ºå¯¹è¯æ¨¡å‹çš„æ–¹å¼ç®€ç›´æ˜¯é›·åŒäº†ï¼ˆè¿™æ ·æŒºå¥½çš„ï¼Œå‡å°‘äº†æˆ‘ä»¬çš„å­¦ä¹ æˆæœ¬ğŸ˜Šï¼‰


æ¥ä¸‹æ¥å†™ä¸ªdemoéªŒè¯ä¸‹æ•ˆæœå¦‚ä½•(å…·ä½“çš„ä½¿ç”¨æ–¹å¼å’Œå‰é¢å¹¶æ²¡æœ‰åŒºåˆ«)


```java
@GetMapping(path = "translateAudioV2")
@ResponseBody
public Object translateAudioV2() throws IOException {
    AudioTranscriptionOptions options = OpenAiAudioTranscriptionOptions.builder()
            .responseFormat(OpenAiAudioApi.TranscriptResponseFormat.JSON)
            .model("FunAudioLLM/SenseVoiceSmall")
            .language("zh")
            .build();
    AudioTranscriptionPrompt prompt = new AudioTranscriptionPrompt(resource, options);
    AudioTranscriptionResponse response = transcriptionModel.call(prompt);
    log.info("response -> {}", response.getResult());
    return response.getResult().getOutput();
}
```


### 5. è¸©å‘è®°å½•

æ•´ä½“çš„éŸ³é¢‘æ¨¡å‹çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æˆ‘åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™å‘ç°äº†å‡ ä¸ªè›‹ç–¼çš„é—®é¢˜

ç°åœ¨çš„ `1.1.2` ç‰ˆæœ¬ä¸­ï¼Œåªæ”¯æŒé…ç½® base-urlï¼Œå¯¹åº”çš„è¯­éŸ³æ˜¯è¢«çš„pathè·¯å¾„åœ¨ä»£ç ä¸­å†™æ­»çš„ä¸º`/v1/audio/translations`

![18-2.webp](https://imgbed.ppai.top/file/1772163049647_18-2.webp)


> æ³¨ï¼šå³ä¾¿ä½ çš„å¤§æ¨¡å‹æ”¯æŒopenStyleçš„æ¥å£é£æ ¼ï¼Œä½†æ˜¯è‹¥pathè·¯å¾„ä¸ä¸€è‡´ï¼Œé‚£ä¹Ÿæ˜¯æ— æ³•ä½¿ç”¨ openai-starter çš„
> 
> è¿™ä¸ªé—®é¢˜åœ¨ `SpringAI ~ 2.0.0-M2` å¾—åˆ°äº†è§£å†³ï¼Œå¦‚ä¸‹å›¾
> ![18-3.webp](https://imgbed.ppai.top/file/1772163253350_18-3.webp)


---

ç¬¬äºŒä¸ªè¸©å‘ç‚¹å°±æ˜¯ä½¿ç”¨OpenAIçš„startè¿›è¡Œè¯­éŸ³è¯†åˆ«æ—¶ï¼Œå¤§æ¨¡å‹çš„æœåŠ¡ç«¯ä¸€ç›´è¿”å›å¼‚å¸¸ `{"detail":[{"type":"missing","loc":["body","file"],"msg":"Field required","input":null}]}` 

![18-4.webp](https://imgbed.ppai.top/file/1772163689795_18-4.webp)

éŸ³é¢‘æ–‡ä»¶æ˜æ˜ä¸Šä¼ äº†ï¼Œä¸ºä»€ä¹ˆæ¨¡å‹ç«¯æç¤ºæ²¡æœ‰å‘¢ï¼Ÿ

ä¸»è¦çš„åŸå› æ˜¯é»˜è®¤çš„ RestClient å…¶åº•å±‚ Client ä¸æ˜¯ JDK HttpClientï¼Œè€Œæ˜¯æŸä¸ªä¸æ”¯æŒ multipart çš„å®ç°ï¼Œä»è€Œåˆ°è¿™äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯¹åº”çš„è§£å†³æ–¹å¼å°±æ˜¯å¼ºåˆ¶æŒ‡å®š

```java
RestClient restClient = RestClient.builder()
        .requestFactory(new JdkClientHttpRequestFactory())
        .build();
```


æ‰€ä»¥ä½ ä¼šåœ¨é¡¹ç›®æºç çš„ Application ä¸­çœ‹åˆ° `RestClient.Builder` çš„æ³¨å†Œï¼Œå°±æ˜¯ä¸ºäº†è§£å†³ä¸Šé¢è¿™ä¸ªé—®é¢˜è€Œå‡ºç°çš„

```java
@SpringBootApplication
public class S19Application {

    public static void main(String[] args) {
        SpringApplication.run(S19Application.class, args);
        System.out.println("å¯åŠ¨æˆåŠŸï¼Œå‰ç«¯æµ‹è¯•è®¿é—®åœ°å€ï¼š http://localhost:8080/translateAudio");
    }


    @Bean
    public RestClient.Builder restClientBuilder() {
        return RestClient.builder()
                // è‹¥åº•å±‚ Client ä¸æ˜¯ JDK HttpClientï¼Œè€Œæ˜¯æŸä¸ªä¸æ”¯æŒ multipart çš„å®ç°,ä»è€Œå¯¼è‡´éŸ³é¢‘ä¸Šä¼ æ— æ³•è¢«æ­£ç¡®è§£æï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸€è¡Œæ¥è°ƒæ•´åº•å±‚çš„ Client
                .requestFactory(new JdkClientHttpRequestFactory())
                .messageConverters(converters -> {
                    converters.add(new FormHttpMessageConverter());
                    converters.add(new ResourceHttpMessageConverter());
                    converters.add(new StringHttpMessageConverter());
                });
    }
}
```


## äºŒã€å°ç»“

æœ¬æ–‡ä»‹ç»äº†è¯­éŸ³å¤§æ¨¡å‹çš„ä½¿ç”¨æ–¹å¼ï¼Œç›®å‰spring-aiå®˜æ–¹ä¹Ÿåªé’ˆå¯¹OpenAIè¿›è¡Œçš„æ”¯æ’‘ï¼Œä¸åŒçš„å‚å•†çš„è¯­éŸ³æ¨¡å‹å¯èƒ½ä¼šæœ‰è‡ªå·±çš„ç‰¹å®šäº¤äº’æ–¹å¼ï¼Œå¤§å®¶åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„ç”„åˆ«


æœ¬æ–‡å¯¹åº”çš„é¡¹ç›®æºç ä¸ºï¼š [S19-audio-transaction](https://github.com/liuyueyi/spring-ai-demo/tree/master/S19-audio-transaction)

