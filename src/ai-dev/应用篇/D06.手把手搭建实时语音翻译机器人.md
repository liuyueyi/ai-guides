---
order: 6
title: D06.æ‰‹æŠŠæ‰‹æ­å»ºå®æ—¶è¯­éŸ³ç¿»è¯‘æœºå™¨äºº
tag:
  - Spring
  - SpringAI
category:
  - SpringAI
date: 2026-03-02 12:15:07
keywords: SpringAI
---

# Spring AI å®æˆ˜ï¼šæ‰‹æŠŠæ‰‹æ­å»ºå®æ—¶è¯­éŸ³ç¿»è¯‘æœºå™¨äºº

å®æ—¶ç¿»è¯‘çš„åœºæ™¯å¯ä»¥è¯´åº”ç”¨å¾ˆä¹…äº†ï¼Œå½“ç„¶åœ¨ä»¥å‰è¿™ä¸ªå®ç°è¿˜æ˜¯å¾ˆæœ‰æŒ‘æˆ˜çš„ï¼Œä¸è¿‡ç°å¦‚ä»Šå˜›ï¼Œåœ¨AIçš„åŠ æŒä¸‹ï¼Œåƒæˆ‘ä»¬è¿™ç§æ™®é€šçš„ç¼–ç¨‹äººå‘˜ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°ä¸€ä¸ªè¯­éŸ³ç¿»è¯‘æœºå™¨äººã€‚

ä»Šå¤©ï¼Œæˆ‘å°†å¸¦ä½ åŸºäº Spring AI æ¡†æ¶ï¼Œä»é›¶æ­å»ºä¸€ä¸ªæ”¯æŒéŸ³é¢‘è½¬å½•ä¸ç¿»è¯‘çš„æ™ºèƒ½æœºå™¨äººã€‚

## ä¸€ã€ç¯å¢ƒå‡†å¤‡

åœ¨å¼€å§‹å®æˆ˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡å¥½å¼€å‘ç¯å¢ƒã€‚ä»¥ä¸‹æ˜¯æœ¬æ–‡æ‰€ä½¿ç”¨çš„æŠ€æœ¯æ ˆï¼š

| ç»„ä»¶ | ç‰ˆæœ¬/è¯´æ˜ |
|------|-----------|
| JDK | 17 åŠä»¥ä¸Š |
| Spring Boot | 3.x |
| Spring AI | 1.1.2 |
| éŸ³é¢‘è½¬å½•æ¨¡å‹ | `FunAudioLLM/SenseVoiceSmall` |
| å¯¹è¯å¤§æ¨¡å‹ | `Qwen/Qwen2.5-7B-Instruct` |
| API å¹³å° | SiliconFlowï¼ˆéœ€è‡ªè¡Œç”³è¯· API Keyï¼‰ |

### 1.1 APIKeyç”³è¯·

ä½ éœ€è¦ SiliconFlow å¹³å°ç”³è¯· API Keyï¼Œå¹¶åœ¨ `application.yml` ä¸­é…ç½®ï¼š

```yaml
spring:
  ai:
    openai:
      api-key: ${silicon-api-key}  # æ›¿æ¢ä¸ºä½ çš„API Key
```

> è¿™é‡Œé€‰æ‹©SiliconFlowçš„ä¸»è¦åŸå› æ˜¯å®ƒçš„å…è´¹æ¨¡å‹ï¼Œå¯¹äºæƒ³è¦å¤åˆ»ä½“éªŒæœ¬é¡¹ç›®çš„å°ä¼™ä¼´æœ€å‹å¥½ğŸ˜Š
> 
> æ³¨å†Œåœ°å€: [https://cloud.siliconflow.cn/i/ge3VpPHH](https://cloud.siliconflow.cn/i/ge3VpPHH)
> 
> ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡äºŒç»´ç æ³¨å†Œï¼š![image.png](https://imgbed.ppai.top/file/1772435807988_silicon_reqr.png)

### 1.2 æ ¸å¿ƒä¾èµ–

ç›´æ¥ä½¿ç”¨`openai-starter`æ¥å®ç°å¤§æ¨¡å‹çš„äº¤äº’ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®çš„å®ç°ä¸­ï¼Œä¸»è¦åŒ…å«ä¸¤ç±»çš„å¤§æ¨¡å‹äº¤äº’è¿‡ç¨‹

- éŸ³é¢‘è¯†åˆ«ï¼šè¯†åˆ«è¯­éŸ³æ–‡ä»¶çš„å†…å®¹
- æ–‡å­—ç¿»è¯‘ï¼šå°†è¯­éŸ³å†…å®¹ç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€

æœ‰éœ€è¦çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥åœ¨å®ç° `æ–‡å­—è½¬è¯­éŸ³` TTSçš„å®ç°ï¼Œä»è€Œè·å–æ›´å¥½çš„ä½¿ç”¨ä½“éªŒ

å¯¹åº”çš„pomæ ¸å¿ƒä¾èµ–å¦‚ä¸‹

```xml
<dependencies>
    <!-- å¤§æ¨¡å‹äº¤äº’çš„æ ¸å¿ƒä¾èµ– -->
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-starter-model-openai</artifactId>
    </dependency>
    <!-- æä¾›webé¡µé¢ + æ¥å£äº¤äº’çš„å®ç°æ”¯æ’‘ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-thymeleaf</artifactId>
    </dependency>
</dependencies>
```

### 1.3 é…ç½®

æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ `resources/application.yml` ç»´æŠ¤ä¸Šæ¨¡å‹å’Œapikey

```yaml
spring:
  thymeleaf:
    cache: false
  ai:
    openai:
      # api-key ä½¿ç”¨ä½ è‡ªå·±ç”³è¯·çš„è¿›è¡Œæ›¿æ¢ï¼›å¦‚æœä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°è¿›è¡Œè®¾ç½®
      api-key: ${silicon-api-key}
      transcription:
        api-key: ${silicon-api-key}
        base-url: https://api.siliconflow.cn/v1
        transcription-path: /audio/transcriptions
        options:
          model: FunAudioLLM/SenseVoiceSmall
          response-format: text
      chat: # èŠå¤©æ¨¡å‹
        options:
          model: Qwen/Qwen2.5-7B-Instruct
      base-url: https://api.siliconflow.cn
```


## äºŒã€æ ¸å¿ƒå®ç°

### 2.0 æ•´ä½“æ–¹æ¡ˆè®¾è®¡

åœ¨å…·ä½“çš„å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªå®æ—¶ç¿»è¯‘åŠŸèƒ½å¯ä»¥æ€ä¹ˆè®¾è®¡ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡æµç¨‹å›¾

![D06-1.webp](https://imgbed.ppai.top/file/1772437882441_D06-1.webp)

```mermaid
flowchart TD
    A[ç”¨æˆ·ä¸Šä¼ éŸ³é¢‘] --> B[ç”Ÿæˆä»»åŠ¡ID]
    B --> C[è¿”å›ä»»åŠ¡IDç»™å‰ç«¯]
    C --> D[å‰ç«¯å»ºç«‹SSEè¿æ¥]
    D --> E[åç«¯å¼‚æ­¥å¤„ç†]
    
    subgraph "å¹¶è¡Œå¤„ç†"
        E --> F[éŸ³é¢‘è½¬å½•]
        E --> G[æ–‡æœ¬ç¿»è¯‘]
    end
    
    F --> H[æ¨é€è½¬å½•ç»“æœ]
    G --> I[æµå¼æ¨é€ç¿»è¯‘]
    I --> J[å¤„ç†å®Œæˆ]
    
    H --> K[å‰ç«¯å®æ—¶æ˜¾ç¤º]
    I --> K
    J --> K
    
    K --> L[ç”¨æˆ·è·å¾—æœ€ç»ˆç»“æœ]
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style E fill:#fff3e0
    style F fill:#e8f5e8
    style G fill:#e8f5e8
    style K fill:#ffebee
```

**ä¸ºä»€ä¹ˆé‡‡ç”¨å¼‚æ­¥ï¼Ÿ**

è€ƒè™‘åˆ°äº¤äº’ä½“éªŒï¼ŒåŒæ­¥é˜»å¡ä¸€ç›´ç­‰å¾…åç«¯è¿”å›å…¨éƒ¨ç»“æœçš„æ–¹æ¡ˆä¸å¯å–ï¼ˆå› ä¸ºè€—æ—¶å¯èƒ½å¾ˆä¹…ï¼‰ï¼›å› æ­¤å®æ—¶çš„äº¤äº’å¿…ç„¶æ˜¯é¦–é€‰ï¼Œå› æ­¤å¼‚æ­¥çš„åŸå› å¦‚ä¸‹ï¼š

- éŸ³é¢‘å¤„ç†è€—æ—¶è¾ƒé•¿ï¼ˆé€šå¸¸å‡ ç§’åˆ°å‡ åç§’ï¼‰
- åŒæ­¥ç­‰å¾…ä¼šè®©ç”¨æˆ·ç•Œé¢å¡é¡¿
- ç”¨æˆ·ä½“éªŒå·®ï¼Œå®¹æ˜“è¯¯è®¤ä¸ºç³»ç»Ÿæ— å“åº”

**è§£å†³æ–¹æ¡ˆï¼š**
```
ç”¨æˆ·ä¸Šä¼ éŸ³é¢‘
    â†“
ç«‹å³è¿”å›ä»»åŠ¡IDï¼ˆ100mså†…ï¼‰
    â†“
åå°å¼‚æ­¥å¤„ç†
    â†“
å®æ—¶æ¨é€å¤„ç†è¿›åº¦
    â†“
ç”¨æˆ·è·å¾—æœ€ç»ˆç»“æœ
```

**SSE (Server-Sent Events) é€‰æ‹©ç†ç”±ï¼š**
- ğŸ”¸ å•å‘æ¨é€ï¼ŒæœåŠ¡ç«¯ä¸»åŠ¨
- ğŸ”¸ HTTPåè®®ï¼Œå…¼å®¹æ€§å¥½
- ğŸ”¸ è‡ªåŠ¨é‡è¿æœºåˆ¶
- ğŸ”¸ æ¯”WebSocketè½»é‡

> è¯·æ³¨æ„SSEä¸æ”¯æŒPOSTè¯·æ±‚ï¼Œå› æ­¤ç”¨æˆ·é€šè¿‡POSTä¸Šä¼ éŸ³é¢‘ï¼Œæ‹¿åˆ°çš„æ˜¯tastIdï¼Œç„¶åå†åŸºäºtaskIdå‘èµ·ä¸€ä¸ªsseçš„è¯·æ±‚ï¼Œç”¨æˆ·å®æ—¶è·å–åç«¯å¤„ç†ç»“æœ

**æ¨é€æ—¶æœºè®¾è®¡ï¼š**

```
è½¬å½•å®Œæˆ â†’ ç«‹å³æ¨é€è¯†åˆ«æ–‡æœ¬
ç¿»è¯‘è¿›è¡Œä¸­ â†’ æµå¼æ¨é€ç¿»è¯‘ç‰‡æ®µ
ç¿»è¯‘å®Œæˆ â†’ å‘é€ç»“æŸä¿¡å·
```

æ¥ä¸‹æ¥ä¹Ÿå¯ä»¥æ ¹æ®ä¸‹é¢çš„è¶…è¯¦ç»†çš„æ—¶åºå›¾ï¼Œæ¥çœ‹çœ‹è¿™ä¸ªå®æ—¶è¯­éŸ³ç¿»è¯‘çš„å®ç°æ€è·¯

![D06-2.webp](https://imgbed.ppai.top/file/1772437555859_D06-2.webp)

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·(User)
    participant B as æµè§ˆå™¨(Browser)
    participant WC as WebViewController
    participant ATC as AutoTranslateController
    participant ATS as AudioTransactionService
    participant SF as SiliconFlow API
    participant CM as ChatModel
    
    Note over U,SF: ç”¨æˆ·ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶åœºæ™¯
    
    U->>B: 1. æ‰“å¼€ç¿»è¯‘é¡µé¢(/translate)
    B->>ATC: 2. GET /auto/translate é¡µé¢è¯·æ±‚
    ATC-->>B: 3. è¿”å› translate.html é¡µé¢
    
    U->>B: 4. é€‰æ‹©éŸ³é¢‘æ–‡ä»¶æˆ–å¼€å§‹å½•éŸ³
    Note right of B: ç”¨æˆ·å¯ä»¥é€‰æ‹©:<br/>- ä¸Šä¼ å·²æœ‰éŸ³é¢‘æ–‡ä»¶<br/>- ä½¿ç”¨éº¦å…‹é£å®æ—¶å½•éŸ³
    
    B->>ATC: 5. POST /auto/uploadAudio<br/>(multipart/form-data)
    Note right of ATC: æ¥æ”¶éŸ³é¢‘æ–‡ä»¶å‚æ•°:<br/>- file: éŸ³é¢‘æ–‡ä»¶<br/>- targetLanguage: ç›®æ ‡è¯­è¨€
    
    ATC->>ATC: 6. ç”Ÿæˆå”¯ä¸€ä»»åŠ¡ID(UUID)
    ATC->>ATC: 7. åˆ›å»ºTranslationTaskè®°å½•
    ATC->>ATC: 8. å­˜å‚¨åˆ°taskMapå†…å­˜æ˜ å°„
    
    ATC-->>B: 9. è¿”å› {taskId: "uuid-string"}
    
    B->>B: 10. åŸºäºtaskIdå»ºç«‹SSEè¿æ¥
    B->>ATC: 11. GET /auto/getResultStream/{taskId}
    
    ATC->>ATC: 12. å­˜å‚¨SseEmitteråˆ°emittersæ˜ å°„
    ATC-->>B: 13. ä¿æŒSSEè¿æ¥å¼€æ”¾
    
    Note over ATC: å¼‚æ­¥å¤„ç†å¼€å§‹
    
    par å¹¶è¡Œå¤„ç†éŸ³é¢‘è½¬å½•
        ATC->>ATS: 14. è°ƒç”¨audioTransaction(file)
        ATS->>SF: 15. POST /v1/audio/transcriptions<br/>(éŸ³é¢‘æ–‡ä»¶ + æ¨¡å‹å‚æ•°)
        SF-->>ATS: 16. è¿”å›è½¬å½•æ–‡æœ¬ç»“æœ
        ATS-->>ATC: 17. è¿”å›è¯†åˆ«åçš„æ–‡æœ¬å†…å®¹
        
        ATC->>ATC: 18. ç­‰å¾…SSEè¿æ¥å»ºç«‹
        loop ç­‰å¾…SSEè¿æ¥
            ATC->>ATC: æ£€æŸ¥emitters.containsKey(taskId)
            Note right of ATC: è½®è¯¢ç­‰å¾…å‰ç«¯å»ºç«‹SSEè¿æ¥
        end
        
        ATC->>B: 19. SSEæ¨é€è½¬å½•ç»“æœ<br/>event: "transcription"<br/>data: "è¯†åˆ«çš„æ–‡æœ¬å†…å®¹"
    and å¹¶è¡Œå¤„ç†ç¿»è¯‘
        ATC->>CM: 20. è°ƒç”¨ChatClientæµå¼ç¿»è¯‘<br/>PromptåŒ…å«:<br/>- ç³»ç»Ÿæç¤ºè¯<br/>- æºæ–‡æœ¬<br/>- ç›®æ ‡è¯­è¨€
        CM->>CM: 21. æµå¼ç”Ÿæˆç¿»è¯‘ç»“æœ
        loop ç¿»è¯‘æµå¼è¾“å‡º
            CM->>ATC: 22. æ¨é€ç¿»è¯‘ç‰‡æ®µ
            ATC->>B: 23. SSEæ¨é€ç¿»è¯‘ç»“æœ<br/>event: "translation"<br/>data: "ç¿»è¯‘æ–‡æœ¬ç‰‡æ®µ"
        end
        CM->>ATC: 24. ç¿»è¯‘å®Œæˆä¿¡å·
        ATC->>B: 25. SSEæ¨é€ç»“æŸä¿¡å·<br/>event: "end"<br/>data: "true"
    end
    
    Note over B: å‰ç«¯å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦
    
    B->>B: 26. å®æ—¶æ›´æ–°UIæ˜¾ç¤º:<br/>- éŸ³é¢‘è½¬å½•ç»“æœ<br/>- æµå¼ç¿»è¯‘å†…å®¹<br/>- å¤„ç†çŠ¶æ€
    
    ATC->>ATC: 27. æ¸…ç†ä»»åŠ¡èµ„æº<br/>- ä»taskMapç§»é™¤ä»»åŠ¡<br/>- ä»emittersç§»é™¤è¿æ¥<br/>- å…³é—­SSEè¿æ¥
    
    Note over U,B: ç”¨æˆ·è·å¾—æœ€ç»ˆç»“æœ
```


### 2.1 éŸ³é¢‘è½¬å½•æœåŠ¡

> å¯¹äºSpringAIå¦‚ä½•ä½¿ç”¨éŸ³é¢‘æ¨¡å‹çš„ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹ - [18.è¯­éŸ³æ¨¡å‹ä¹‹è¯­éŸ³è¯†åˆ« | Helllo LLM Guides](https://www.ppai.top/ai-guides/ai-dev/%E5%9F%BA%E7%A1%80%E7%AF%87/18.%E8%AF%AD%E9%9F%B3%E6%A8%A1%E5%9E%8B%E4%B9%8B%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB.html)


é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºéŸ³é¢‘è½¬å½•æœåŠ¡ï¼Œåˆ©ç”¨ Spring AI çš„ `TranscriptionModel` æ¥å£è°ƒç”¨ SenseVoiceSmall æ¨¡å‹ï¼š

```java
@Service
public class AudioTransactionService {
    @Autowired
    private TranscriptionModel transcriptionModel;

    public String audioTransaction(MultipartFile file) throws IOException {
        // é…ç½®è½¬å½•é€‰é¡¹
        AudioTranscriptionOptions options = OpenAiAudioTranscriptionOptions.builder()
                .responseFormat(OpenAiAudioApi.TranscriptResponseFormat.JSON)
                .model("FunAudioLLM/SenseVoiceSmall")
                .build();

        // å°†ä¸Šä¼ æ–‡ä»¶è½¬ä¸º Resource å¯¹è±¡
        Resource resource = new ByteArrayResource(file.getBytes()) {
            @Override
            public String getFilename() {
                return file.getOriginalFilename();
            }
        };

        // è°ƒç”¨è½¬å½•æœåŠ¡
        AudioTranscriptionPrompt prompt = new AudioTranscriptionPrompt(resource, options);
        AudioTranscriptionResponse response = transcriptionModel.call(prompt);
        return response.getResult().getOutput();
    }
}
```

**ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ**

Spring AI ç»Ÿä¸€äº† AI æ¨¡å‹çš„è°ƒç”¨æ¥å£ï¼Œ`TranscriptionModel` å±è”½äº†åº•å±‚ API çš„å·®å¼‚ï¼Œæˆ‘ä»¬åªéœ€å…³æ³¨ä¸šåŠ¡é€»è¾‘å³å¯ã€‚

ä¸Šé¢è¿™ä¸ªserviceå®ç°è¯†åˆ«éŸ³é¢‘æ–‡ä»¶å†…å®¹ï¼Œå¹¶ç›´æ¥è¿”å›ç»“æœç»™è°ƒç”¨æ–¹ï¼ˆæˆ‘ä»¬ç°åœ¨é€‰ä¸­çš„æ¨¡å‹ä¸»è¦æ”¯æŒä¸­è‹±æ–‡å†…å®¹çš„è¯†åˆ«ï¼‰

### 2.2 ç¿»è¯‘æœåŠ¡ + SSE å®æ—¶æ¨é€

ä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬é‡‡ç”¨å¼‚æ­¥å¤„ç† + SSEï¼ˆServer-Sent Eventsï¼‰å®ç°å®æ—¶æ¨é€ï¼š

```java
// å­˜å‚¨ä»»åŠ¡çŠ¶æ€çš„å†…å­˜æ˜ å°„
private final Map<String, TranslationTask> taskMap = new ConcurrentHashMap<>();
private Map<String, SseEmitter> emitters = new ConcurrentHashMap<>();
// ç¿»è¯‘ä»»åŠ¡è®°å½•ç±»
private record TranslationTask(String taskId, MultipartFile file, String targetLanguage) {
}

@PostMapping(path = "uploadAudio")
public Map<String, String> uploadAudio(
        @RequestParam("file") MultipartFile file, 
        String targetLanguage) {
    // ç”Ÿæˆå”¯ä¸€ä»»åŠ¡ID
    String taskId = UUID.randomUUID().toString();
    taskMap.put(taskId, new TranslationTask(taskId, file, targetLanguage));
    
    // å¼‚æ­¥å¤„ç†ä»»åŠ¡
    processTranslationTask(taskId);
    return Map.of("taskId", taskId);
}

@GetMapping(path = "getResultStream/{taskId}")
public SseEmitter getResultStream(@PathVariable String taskId) {
    SseEmitter emitter = new SseEmitter();
    emitters.put(taskId, emitter);
    return emitter;
}
```

å…³é”®çš„å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š

```java
private void processTranslationTask(String taskId) {
    new Thread(() -> {
        // ç¬¬ä¸€æ­¥ï¼šéŸ³é¢‘è½¬å½•
        String transcription = audioTransactionService.audioTransaction(task.file());
        sseEmitter.send(SseEmitter.event().name("transcription").data(transcription));

        // ç¬¬äºŒæ­¥ï¼šæµå¼ç¿»è¯‘
        PromptTemplate promptTemplate = new PromptTemplate(TRANS_SYSTEM_PROMPT);
        Prompt prompt = promptTemplate.create(Map.of(
                "lan", task.targetLanguage,
                "content", transcription));
        
        Flux<String> res = chatClient.prompt(prompt).stream().content();
        res.subscribe(txt -> {
            sseEmitter.send(SseEmitter.event().name("translation").data(txt));
        });
    }).start();
}
```

> æ³¨ï¼šä¸Šé¢çš„ä»£ç ä¸»è¦æ˜¾ç¤ºæ ¸å¿ƒçš„ä¸šåŠ¡ä½“ç°ï¼ŒçœŸå®çš„å®ç°ä¸­è¿˜åŒ…å«èµ„æºå›æ”¶ï¼ˆsseEmitterå…³é—­ï¼Œæ¸…é™¤ç¼“å­˜ä¿¡æ¯ç­‰ï¼‰,è¯¦æƒ…è¯·å‚è€ƒæ–‡æœ«çš„é¡¹ç›®æºç 


### 2.3 å‰ç«¯äº¤äº’

å‰ç«¯é€šè¿‡ EventSource æ¥æ”¶ SSE æ¨é€ï¼Œå®ç°å®æ—¶æ˜¾ç¤ºï¼š

```javascript
// å»ºç«‹SSEè¿æ¥
const eventSource = new EventSource(`/auto/getResultStream/${taskId}`);

eventSource.addEventListener('transcription', (e) => {
    console.log('è½¬å½•ç»“æœ:', e.data);
    document.getElementById('transcription').innerText = e.data;
});

eventSource.addEventListener('translation', (e) => {
    // æµå¼æ˜¾ç¤ºç¿»è¯‘ç»“æœ
    document.getElementById('translation').innerHTML += e.data;
});

eventSource.addEventListener('end', () => {
    eventSource.close();
});
```

## ä¸‰ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### Q1ï¼šé•¿éŸ³é¢‘è§£æè¾ƒæ…¢é—®é¢˜

**é—®é¢˜**ï¼šç°åœ¨å¤§æ¨¡å‹çš„è¯­éŸ³è¯†åˆ«ä¸ºåŒæ­¥è°ƒç”¨ï¼Œå¯¹äºé•¿éŸ³é¢‘è§£æè¾ƒæ…¢

**è§£å†³**ï¼šå¯¹éŸ³é¢‘è¿›è¡Œåˆ‡å‰²ï¼Œå¹¶è¡Œè°ƒç”¨å¤§æ¨¡å‹æ¥å£ï¼ŒæŒ‰ç…§é¡ºåºè¿”å›ç»™å‰ç«¯ç”¨æˆ·

```java
/**
 * å¹¶è¡Œå¤„ç†éŸ³é¢‘æ–‡ä»¶ï¼ˆæ™ºèƒ½åˆ†å‰²ï¼‰
 * 
 * @param file éŸ³é¢‘æ–‡ä»¶
 * @param useParallel æ˜¯å¦ä½¿ç”¨å¹¶è¡Œå¤„ç†
 * @return è½¬å½•ç»“æœ
 */
public String audioTransactionParallel(MultipartFile file, boolean useParallel) throws IOException {
    if (!useParallel) {
        return audioTransactionSingle(file);
    }
    
    long startTime = System.currentTimeMillis();
    
    try {
        // æ™ºèƒ½åˆ†å‰²éŸ³é¢‘
        List<AudioSegmentationService.AudioSegment> segments = segmentationService.smartSegment(file);
        
        if (segments.size() <= 1) {
            log.info("éŸ³é¢‘æ–‡ä»¶è¾ƒå°ï¼Œç›´æ¥å¤„ç†");
            return audioTransactionSingle(file);
        }
        
        // å¹¶è¡Œå¤„ç†æ‰€æœ‰ç‰‡æ®µ
        List<CompletableFuture<String>> futures = segmentationService.processSegmentsParallel(
            segments,
            this::transcribeSegment
        );
        
        // æ”¶é›†ç»“æœ
        List<String> results = segmentationService.collectResults(futures);
        
        // åˆå¹¶ç»“æœ
        String finalResult = mergeTranscriptionResults(results);
        
        long endTime = System.currentTimeMillis();
        log.info("å¹¶è¡Œå¤„ç†å®Œæˆï¼Œæ€»è€—æ—¶: {}msï¼Œç‰‡æ®µæ•°: {}ï¼Œç»“æœé•¿åº¦: {}å­—ç¬¦",  endTime - startTime, segments.size(), finalResult.length());
        
        return finalResult;
        
    } catch (Exception e) {
        log.error("å¹¶è¡Œå¤„ç†éŸ³é¢‘æ–‡ä»¶å¤±è´¥ï¼Œå›é€€åˆ°å•çº¿ç¨‹å¤„ç†", e);
        return audioTransactionSingle(file);
    }
}
```

### Q2ï¼šè½¬å½•ç»“æœä¸ºç©º

**é—®é¢˜**ï¼šéŸ³é¢‘æ–‡ä»¶æ ¼å¼ä¸è¢«æ”¯æŒã€‚

**è§£å†³**ï¼šç¡®ä¿éŸ³é¢‘æ ¼å¼ä¸º MP3ã€WAV æˆ– M4Aï¼Œä¸”éŸ³é¢‘è´¨é‡æ¸…æ™°ã€‚

### Q3: ç¿»è¯‘ç»“æœæœ—è¯»

**é—®é¢˜**ï¼šç°åœ¨ç¿»è¯‘çš„ç»“æœæ˜¯ä»¥æ–‡å­—çš„æ–¹å¼è¿›è¡Œæ˜¾ç¤ºï¼Œæˆ‘å¸Œæœ›ä»¥è¯­éŸ³æ’­æŠ¥çš„æ–¹å¼æ¥å‘ˆç°

**è§£å†³**ï¼šé¡¹ç›®åŸå‹ä¸­æä¾›äº†ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„è¯­éŸ³åˆæˆæ¥å®ç°ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©ä¸€äº›æ¨¡å‹å‚å®¶æä¾›çš„TTSæ¨¡å‹æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½


## å››ã€æµ‹è¯•å°ç»“

å¯åŠ¨åº”ç”¨åï¼Œè®¿é—® `http://localhost:8080/translate`ï¼Œä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ï¼Œæ•´ä¸ªè¿‡ç¨‹å»¶è¿Ÿæ§åˆ¶åœ¨ç§’çº§ï¼Œä½“éªŒè¿˜æ˜¯æ¯”è¾ƒæµç•…çš„

![D06-3.gif](https://imgbed.ppai.top/file/1772441431415_D06-3.gif)


é™¤äº†ä¸Šé¢çš„ä¼ è¾“éŸ³é¢‘ä¹‹å¤–ï¼Œè¿˜æ˜¯æ”¯æŒè¯­éŸ³å½•å…¥ç¿»è¯‘çš„ï¼Œå¦‚ä¸‹

![D06-4.gif](https://imgbed.ppai.top/file/1772442648403_D06-4.gif)

æœ¬æ–‡ä¸­æ‰€æœ‰çš„æºç ï¼Œéƒ½å¯ä»¥åœ¨ä¸‹é¢ä»“åº“ä¸­è·å–

- [https://github.com/liuyueyi/spring-ai-demo/tree/master/v2/T05-voice-chat-robot](https://github.com/liuyueyi/spring-ai-demo/tree/master/v2/T05-voice-chat-robot)


æ•´ä½“å®ç°ä¸‹æ¥åŸºæœ¬ä¸Šæ²¡æœ‰å¤ªå¤§çš„éš¾åº¦ï¼Œå¯¹äºç†Ÿç»ƒè°ƒç”¨APIçš„å°ä¼™ä¼´ï¼Œä¼šæƒŠäººçš„å‘ç°ï¼Œè¿™AIåº”ç”¨çœ‹èµ·æ¥å’Œè°ƒæ¥å£æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«å•Šï¼Œä¸ºå•¥è¿˜ä¼šæœ‰ä¸“é—¨çš„å¤§æ¨¡å‹å¼€å‘å²—ï¼Ÿå’Œä¼ ç»Ÿçš„åç«¯å¼€æ”¾åˆ°åº•æœ‰å•¥ä¸ä¸€æ ·çš„ï¼Ÿå¦‚æœæœ‰æ­¤ç–‘é—®çš„è¯ï¼Œä¸å¦¨èŠ±ä¸ªå‡ åˆ†é’Ÿçœ‹çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œç›¸ä¿¡ä¼šæœ‰ä¸ä¸€æ ·çš„æ„Ÿè§¦ğŸ˜Š

é›¶åŸºç¡€å…¥é—¨ï¼š

- [LLM åº”ç”¨å¼€å‘æ˜¯ä»€ä¹ˆï¼šé›¶åŸºç¡€ä¹Ÿå¯ä»¥è¯»æ‡‚çš„ç§‘æ™®æ–‡(æç®€ç‰ˆ)](https://mp.weixin.qq.com/s/qCn8x2XO2shA8MheYbHq0w)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šåº-ä¸ºä»€ä¹ˆä½ â€œä¼šç”¨ LLMâ€ï¼Œä½†åšä¸å‡ºå¤æ‚åº”ç”¨ï¼Ÿ](https://mp.weixin.qq.com/s/2GXBNOUq3jlysipftz8TpA)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¸€ç«  LLMåˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ](https://mp.weixin.qq.com/s/v-z6EHY300ElOxdGPdzc0w)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬äºŒç«  æ¨¡å‹ä¸æ˜¯é‡ç‚¹ï¼Œå‚æ•°æ‰æ˜¯ä½ çœŸæ­£çš„æ§åˆ¶é¢æ¿](https://mp.weixin.qq.com/s/t_BuAW9i0npcaJdua3Am2Q)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¸‰ç«  ä¸ºä»€ä¹ˆæˆ‘çš„Promptè¡¨ç°å¾ˆç³Ÿï¼Ÿ](https://mp.weixin.qq.com/s/vzt0bGwcfnASOiBa0Kc7VQ)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬å››ç«  Prompt çš„å·¥ç¨‹åŒ–ç»“æ„è®¾è®¡](https://mp.weixin.qq.com/s/Nk-N34TLJVCTI5F4k5rGaQ)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬äº”ç«  ä» Prompt åˆ° Prompt æ¨¡æ¿ä¸å·¥ç¨‹æ²»ç†](https://mp.weixin.qq.com/s/ZQbztqBq7_PzynG06N4-mg)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬å…­ç«  ä¸Šä¸‹æ–‡çª—å£çš„çœŸå®è¾¹ç•Œ](https://mp.weixin.qq.com/s/nnKspRO87xbrn4-LBV3RNA)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¸ƒç«  ä» â€œå †ä¸Šä¸‹æ–‡â€ åˆ° â€œç®¡ç†ä¸Šä¸‹æ–‡â€](https://mp.weixin.qq.com/s/_5D2tF6CPnafj5mlmlwLNw)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬å…«ç«  è®°å¿†ç­–ç•¥çš„å·¥ç¨‹åŒ–é€‰æ‹©](https://mp.weixin.qq.com/s/z5qaLtjChsvjhWNs8Nw05Q)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¹ç«  ä¸Šä¸‹æ–‡å·¥ç¨‹åœ¨ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹ä¸­çš„è½åœ°](https://mp.weixin.qq.com/s/MFvE8ahSyIhMZIFeSI91kg)


---

å®æˆ˜

- [å®æˆ˜ | ä¸¤ç™¾è¡Œå®ç°ä¸€ä¸ªè‡ªç„¶è¯­è¨€åœ°å€æå–æ™ºèƒ½ä½“](https://mp.weixin.qq.com/s/96rHyp_gBUgmA2dhSbzNww)
- [å®æˆ˜ | åŸºäºSpringAIä¸å¤§æ¨¡å‹çš„é›¶é…ç½®å‘ç¥¨æ™ºèƒ½æå–æ¶æ„](https://mp.weixin.qq.com/s/SnXdTB6tYqAzG7HgbnTSAQ)
- [å®æˆ˜ | é›¶åŸºç¡€æ­å»ºçŸ¥è¯†åº“é—®ç­”æœºå™¨äººï¼šåŸºäºSpringAI+RAGçš„å®Œæ•´å®ç°](https://mp.weixin.qq.com/s/NHqLJbos-_nrxNNmhg7IBQ)
- [å‘Šåˆ«ä¼ ç»ŸAIå¼€å‘ï¼SpringAI Agent + Skillsé‡æ–°å®šä¹‰æ™ºèƒ½åº”ç”¨](https://mp.weixin.qq.com/s/ujxVleNhjxzUgL-rjfFcVA)
- [Spring AIä¸­çš„å¤šè½®å¯¹è¯è‰ºæœ¯ï¼šè®©å¤§æ¨¡å‹ä¸»åŠ¨æé—®è·å–æ˜ç¡®éœ€æ±‚](https://mp.weixin.qq.com/s/LcvmiIERs6aOIlRAKGGnFg)
- [å®æˆ˜ | æˆ‘ç”¨SpringAIé€ äº†ä¸ªã€Œå¾®ä¿¡çº¢åŒ…å°é¢è®¾è®¡å¸ˆã€](https://mp.weixin.qq.com/s/QyuWZ4EZ32pbcWn3fVphHQ)
