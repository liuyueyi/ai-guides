---
order: 2
title: D02.ä»0åˆ°1å®ç°ä¸€ä¸ªè‡ªç„¶è¯­è¨€æå–åœ°å€ä¿¡æ¯çš„æ™ºèƒ½ä½“
tag:
  - Spring
  - SpringAI
category:
  - SpringAI
date: 2026-01-14 10:15:07
keywords: SpringAI
---

å¤§æ¦‚ä¸¤å¹´ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¿«é€’ç±»å‹çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¸ºäº†ç®€åŒ–ç”¨æˆ·çš„æ“ä½œï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå¿«æ·åŠŸèƒ½ï¼Œæ”¯æŒç”¨æˆ·ç›´æ¥ç²˜è´´ä¸€æ®µè‡ªç„¶è¯­è¨€çš„æ–‡æœ¬ï¼Œç„¶åç”±ç¨‹åºåå°åŸºäºè¿™æ®µæ–‡æœ¬è‡ªåŠ¨æå–å‡ºç»“æ„åŒ–çš„åœ°å€ä¿¡æ¯ï¼Œåœ¨æ–¹å¼å¤§æ¨¡å‹è¿˜æœªæ™®åŠï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯baiduçš„ä¸€ä¸ªæ”¶è´¹æ¥å£

![](/imgs/column/springai/D02-1.webp)

è™½ç„¶ä»·æ ¼ä¸è´µï¼Œä½†æ€»å½’ä¹Ÿæ˜¯æ”¶è´¹ä¸æ˜¯ï¼›è¿™ä¸ªåœºæ™¯éå¸¸å‚ç›´èšç„¦ï¼Œæ­£å¥½ä¹Ÿå¯ä»¥ä½œä¸ºæˆ‘ä»¬åº”ç”¨é›†æˆLLMçš„ä¸€ä¸ªå®éªŒç”°ã€‚æ¥ä¸‹æ¥æˆ‘å°†ä»‹ç»ä¸‹å¦‚ä½•åˆ©ç”¨ Spring AI æ¡†æ¶ç»“åˆå¤§æ¨¡å‹èƒ½åŠ›ï¼Œå®ç°ä»è‡ªç„¶è¯­è¨€æ–‡æœ¬ä¸­è‡ªåŠ¨æå–ç»“æ„åŒ–åœ°å€ä¿¡æ¯çš„å®Œæ•´æ–¹æ¡ˆï¼Œå¹¶ä¸”é€šè¿‡function callå®æ—¶æŸ¥è¯¢è¡Œæ”¿ç¼–ç ï¼Œä»è€Œæ‰“é€ ä¸€ä¸ªå®Œæ•´å¯ç›´æ¥å•†ç”¨çš„ `â€œåœ°å€æå–æ™ºèƒ½ä½“â€`


## ä¸€ã€æ•´ä½“æ¶æ„è®¾è®¡

### 1.1 æŠ€æœ¯æ ˆé€‰å‹

- **SpringAI 1.1.2**ï¼šç»Ÿä¸€AIè°ƒç”¨æ¡†æ¶
- **ZhiPu**ï¼šä½¿ç”¨å®ƒçš„å…è´¹ç‰ˆå¤§æ¨¡å‹ `GLM-4-Flash`
- **Function Calling**ï¼šè®©å¤§æ¨¡å‹å…·å¤‡è°ƒç”¨å¤–éƒ¨APIçš„èƒ½åŠ›
- **SpringBoot 3.x**ï¼šç°ä»£åŒ–Javaæ¡†æ¶
- **JDK17+**: javaç‰ˆæœ¬æœ€ä½è¦æ±‚17
- **è¡Œæ”¿åŒºåˆ’ç¼–ç åº“**ï¼š[Administrative-divisions-of-China](https://github.com/modood/Administrative-divisions-of-China)

### 1.2 ç³»ç»Ÿæ¶æ„

ä»æ•´ä½“çš„è§†è§’æ¥çœ‹ï¼Œè¿™ä¸ªåœ°å€ä¿¡æ¯çš„æå–ç»“æ„ç›¸å¯¹æ¸…æ™°ï¼ŒåŸºäºç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€ã€é€šè¿‡LLMè·å–ç»“æ„åŒ–çš„åœ°å€ä¿¡æ¯ï¼Œç„¶åè¿”å›ç»™ç”¨æˆ·ï¼›

ç»“åˆåº”ç”¨ç¨‹åºå¯¹åœ°å€çš„ä½¿ç”¨ç­–ç•¥ï¼Œæˆ‘ä»¬åœ¨åŸºæœ¬ä¸­æ–‡åœ°å€æå–ä¹‹å¤–ï¼Œé€šè¿‡Function Callingæœºåˆ¶ï¼Œå®ç°è®©å¤§æ¨¡å‹è¿”å›çš„ç»“æ„åŒ–ä¿¡æ¯ä¸­ï¼ŒåŒ…å«è¡Œæ”¿åŒºåŸŸä»£ç ï¼Œè¿™æ ·æ›´æ–¹ä¾¿å°†å¤§æ¨¡å‹è¿”å›çš„åœ°å€ä¿¡æ¯ä¸é¡¹ç›®ä¸­è‡ªå·±ç»´æŠ¤çš„åœ°å€ä¿¡æ¯è¿›è¡Œæ˜ å°„ï¼›

> è¯´æ˜ï¼šè¿”å›è¡Œæ”¿åŒºåŸŸç¼–ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…å‡ºç° æœ¬åœ°åœ°å€åº“ä¸­å­˜ `æ¹–åŒ—çœã€æ­¦æ±‰å¸‚`ï¼Œä½†æ˜¯å¤§æ¨¡å‹è¿”å›çš„æ˜¯ `æ¹–åŒ—ã€æ­¦æ±‰` è¿™ç±»æ–‡æœ¬ï¼Œå¯¼è‡´åå°ç¨‹åºæ— æ³•ç²¾ç¡®æ ¹æ®åœ°å€æ–‡æœ¬è¿›è¡Œæ˜ å°„çš„åœºæ™¯ï¼›é€šè¿‡ç»Ÿä¸€çš„è¡Œæ”¿åŒºåŸŸç¼–ç ï¼Œåˆ™å¯ä»¥æœ‰æ•ˆè§„é¿è¿™ç§åœºæ™¯


ä¸‹é¢æ˜¯æ•´ä½“çš„ç»“æ„å›¾

![](/imgs/column/springai/D02-2.webp)

```Mermaid
flowchart TB
    %% æ ·å¼å®šä¹‰ï¼šæŒ‰åŠŸèƒ½åˆ†ç±»ï¼Œå»¶ç»­ç³»åˆ—é…è‰²ä½“ç³»
    classDef inputNode fill:#e1f5fe,stroke:#0288d1,stroke-width:2px,rounded:10px,font-size:13px
    classDef subgraphNode fill:#fafafa,stroke:#9c27b0,stroke-width:2px,rounded:10px
    classDef coreNode fill:#fce4ec,stroke:#c2185b,stroke-width:2px,rounded:10px,font-size:13px
    classDef logicNode fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,rounded:10px,font-size:13px
    classDef funcNode fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px,rounded:10px,font-size:13px
    classDef outputNode fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,rounded:10px,font-size:13px
    classDef noteNode fill:#fafafa,stroke:#bdbdbd,stroke-dasharray:3 3,rounded:8px,font-size:12px

    %% èµ·å§‹èŠ‚ç‚¹ï¼šç”¨æˆ·è¾“å…¥
    input["ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€åœ°å€<br/>Input: Natural Language Address<br/>ï¼ˆå¦‚ï¼šåŒ—äº¬å¸‚æœé˜³åŒºXXè¡—XXå°åŒºï¼‰"]:::inputNode

    %% æ ¸å¿ƒå­æ¨¡å—ï¼šSpringAI æ™ºèƒ½åœ°å€è§£æå™¨
    subgraph SpringAIæ™ºèƒ½åœ°å€è§£æå™¨SpringAI Address Parser
        style åœ°å€æå–æ™ºèƒ½ä½“ fill:#fcf1f7,stroke:#c2185b,stroke-width:3px,rounded:10px
        prompt["Prompt å·¥ç¨‹ + ç»“æ„åŒ–è¾“å‡ºçº¦æŸ<br/>Prompt Engineering<br/>ï¼ˆå¼ºåˆ¶è¿”å›ï¼šçœ/å¸‚/åŒº/è¡—/é—¨ç‰Œï¼‰"]:::coreNode
    end

    %% ä¸­é—´å¤„ç†èŠ‚ç‚¹
    structAddr["ç»“æ„åŒ–åœ°å€ä¿¡æ¯<br/>Structured Address Info<br/>ï¼ˆæ ‡å‡†åŒ–åœ°å€åˆ†æ®µæ ¼å¼ï¼‰"]:::logicNode
    funcCall["Function Call<br/>è¡Œæ”¿åŒºåˆ’ç¼–ç æŸ¥è¯¢<br/>ï¼ˆä»åœ°å€åº“è·å–è¡Œæ”¿ç¼–ç ï¼‰"]:::funcNode

    %% æœ€ç»ˆè¾“å‡ºèŠ‚ç‚¹
    output["æ ‡å‡†åŒ–åœ°å€è¾“å‡º<br/>Standardized Address Output<br/>+ è¡Œæ”¿åŒºåŸŸç¼–ç <br/>ï¼ˆç¬¦åˆå›½æ ‡GB/T 2260æ ¼å¼ï¼‰"]:::outputNode

    %% æµç¨‹è¿æ¥ï¼šå¼ºåŒ–é“¾è·¯é€»è¾‘
    input -->|è§£æè¯·æ±‚| prompt
    prompt -->|åœ°å€åˆ†æ®µç»“æœ| structAddr
    prompt -->|ç¼–ç æŸ¥è¯¢è§¦å‘| funcCall
    structAddr -->|æ•´åˆ| output
    funcCall -->|ç¼–ç ç»“æœ| output

    %% æ ¸å¿ƒæ³¨è§£ï¼šç‚¹æ˜æµç¨‹ä»·å€¼
    note[ğŸ“Œ æ ¸å¿ƒé€»è¾‘ï¼šé€šè¿‡ Prompt çº¦æŸ+Function Call å®ç°è‡ªç„¶è¯­è¨€åœ°å€â†’æ ‡å‡†åŒ–åœ°å€+è¡Œæ”¿ç¼–ç çš„è½¬åŒ–]:::noteNode
    prompt -.-> note

    %% ç®­å¤´æ ·å¼ï¼šå¼ºåŒ–é“¾è·¯åŒºåˆ†
    linkStyle 0 stroke:#616161,stroke-width:1.5px
    linkStyle 1 stroke:#c2185b,stroke-width:1.5px
    linkStyle 2 stroke:#c2185b,stroke-width:1.5px
    linkStyle 3 stroke:#388e3c,stroke-width:1.5px
    linkStyle 4 stroke:#388e3c,stroke-width:1.5px
```

## äºŒã€æ ¸å¿ƒå®ç°æ­¥éª¤

é¦–å…ˆæˆ‘ä»¬éœ€è¦æ­å»ºè¦ç»™SpringAIçš„é¡¹ç›®ï¼Œä¸å¤ªç†Ÿæ‚‰çš„å°ä¼™ä¼´å¯ä»¥å‚ç…§ [01.åˆ›å»ºä¸€ä¸ªSpringAIçš„ç¤ºä¾‹å·¥ç¨‹ | ä¸€ç°ç°çš„ç«™ç‚¹](https://hhui.top/tutorial/spring/springai/%E5%9F%BA%E7%A1%80%E7%AF%87/01.%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AASpringAI-Demo%E5%B7%A5%E7%A8%8B.html) æ¥å®Œæˆ

åœ¨ä¸‹é¢çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ™ºè°±çš„å…è´¹å¤§æ¨¡å‹ä½œä¸ºæˆ‘ä»¬çš„å®é™…è½½ä½“ï¼›è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–çš„æ¨¡å‹çš„å°ä¼™ä¼´ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ›¿æ¢ï¼ˆSpringAIå¯¹ä¸åŒå‚å•†çš„å¤§æ¨¡å‹é›†æˆå¾—ç›¸å½“å¯ä»¥ï¼Œåˆ‡æ¢æˆæœ¬è¾ƒä½ï¼‰

### 2.1 ç¯å¢ƒé…ç½®ä¸ä¾èµ–

æˆ‘ä»¬ä½¿ç”¨çš„SpringAIçš„ç‰ˆæœ¬ä¸ºæœ€æ–°çš„ `1.1.2` ï¼Œæ­¤å¤–ç›´æ¥ä½¿ç”¨ zhipu çš„starteræ¥ä½œä¸ºå¤§æ¨¡å‹çš„äº¤äº’å®¢æˆ·ç«¯

```xml
<!-- pom.xml å…³é”®ä¾èµ– -->
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-starter-model-zhipuai</artifactId>
    </dependency>
</dependencies>
```

ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè®¾ç½®å¯¹åº”çš„é…ç½®ä¿¡æ¯ï¼Œå…¶ä¸­å…³é”®ç‚¹ä¸º 

- api-key: å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°ã€ç³»ç»Ÿç¯å¢ƒå˜é‡ç­‰æ–¹å¼æ³¨å…¥keyï¼Œä»è€Œé¿å…ç¡¬ç¼–ç å¯¼è‡´çš„æ³„éœ²é—®é¢˜
- model: é€‰æ‹©çš„æ˜¯å…è´¹çš„ `GLM-4-Flash`ï¼Œ æ”¯æŒ `function call` ï¼ˆè¯´æ˜ï¼šè‹¥ä½ é€‰ä¸­çš„æ¨¡å‹ä¸æ”¯æŒå‡½æ•°è°ƒç”¨ï¼Œé‚£ä¹ˆå°±æ— æ³•å®ç°åç»­çš„è¡Œæ”¿åŒºåŸŸæŸ¥è¯¢çš„å·¥å…·æ³¨å…¥ï¼‰

```yaml
# application.yml
spring:
  ai:
    zhipuai:
      # api-key ä½¿ç”¨ä½ è‡ªå·±ç”³è¯·çš„è¿›è¡Œæ›¿æ¢ï¼›å¦‚æœä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°è¿›è¡Œè®¾ç½®
      api-key: ${zhipuai-api-key}
      chat:
        options:
          model: GLM-4-Flash


# ä¿®æ”¹æ—¥å¿—çº§åˆ«
logging:
  level:
    org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor: debug
```

### 2.2 åœ°å€æ•°æ®ç»“æ„è®¾è®¡

é¦–å…ˆå®šä¹‰ä¸€ä¸‹æˆ‘ä»¬å¸Œæœ›æ¥å—çš„ç»“æ„åŒ–è¿”å›æ•°æ®ï¼Œä»¥å¸¸è§çš„å¿«é€’ç‰©æµçš„åœ°å€ä¿¡æ¯ä¸ºä¾‹ï¼Œå…³é”®ä¿¡æ¯åŒ…å«ï¼š

- çœ
- å¸‚
- åŒº
- è¡—é“
- è¯¦ç»†åœ°å€
- ç”¨æˆ·
- æ‰‹æœºå·

```java
record Address(
        @JsonPropertyDescription("çœï¼Œå¦‚ æ¹–åŒ—çœ")
        String province,
        @JsonPropertyDescription("å¸‚ï¼Œå¦‚ æ­¦æ±‰å¸‚")
        String city,
        @JsonPropertyDescription("åŒºï¼Œå¦‚ æ­¦æ˜ŒåŒº")
        String area,
        @JsonPropertyDescription("è¡—é“ï¼Œå¦‚ ä¸œæ¹–è·¯")
        String street,
        @JsonPropertyDescription("è¡Œæ”¿åŒºåŸŸç¼–ç ï¼Œå¦‚ 420106")
        String adCode,
        @JsonPropertyDescription("è¯¦ç»†åœ°å€ï¼Œå¦‚ å‘è´¢æ— é™å…¬å¸8æ ‹8å•å…ƒ888å·")
        String detailInfo,
        @JsonPropertyDescription("è”ç³»äººï¼Œå¦‚ å¼ ä¸‰")
        String personName,
        @JsonPropertyDescription("è”ç³»äººç”µè¯ï¼Œå¦‚ 15345785872")
        String personPhone
) {
}
```

### 2.3 å¿«é€ŸåŸå‹å®ç°

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ç›´æ¥ä½¿ç”¨å¤§æ¨¡å‹æœ¬èº«çš„æ–‡æœ¬æå–èƒ½åŠ›ï¼Œå¿«é€Ÿå®ç°ä¸€ä¸ªåŸºç¡€çš„åŸå‹

```java
@RestController
public class ChatController {
    private final ChatModel chatModel;

       @Autowired
    public ChatController(ChatModel chatModel) {
        this.chatModel = chatModel;
    }

    /**
     * ä»ä¼ å…¥çš„è‡ªç„¶è¯­è¨€ä¸­ï¼Œæå–å‡ºåœ°å€ä¿¡æ¯
     *
     * @param content
     * @return
     */
    @GetMapping("/ai/genAddress")
    public Address generateAddress(String content) {
        BeanOutputConverter<Address> beanOutputConverter = new BeanOutputConverter<>(Address.class);
        String format = beanOutputConverter.getFormat();


        PromptTemplate template = new PromptTemplate("è¯·ä»ä¸‹é¢ä¸ªä½ çš„æ–‡æœ¬ä¸­ï¼Œå¸®æˆ‘æå–è¯¦ç»†çš„åœ°å€ä¿¡æ¯ï¼Œè¦æ±‚ä¸­æ–‡è¿”å›: \n\nåœ°å€ä¿¡æ¯ï¼š\n{area} \n\nè¿”å›æ ¼å¼:{format}");
        Prompt prompt = template.create(Map.of("area", content, "format", format));
        Generation generation = chatModel.call(prompt).getResult();
        if (generation == null) {
            return null;
        }
        return beanOutputConverter.convert(generation.getOutput().getText());
    }
}
```

åœ¨ä¸Šé¢çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ `ChatModel` è¿›è¡Œå¤§æ¨¡å‹çš„äº¤äº’ï¼Œåœ¨è¿™ä¸åˆ°10è¡Œçš„ä»£ç ä¸­ï¼Œä¸»è¦ä½¿ç”¨åˆ°ä¸¤ä¸ªæŠ€æœ¯ç‚¹

- æç¤ºè¯æ¨¡æ¿ï¼š PromptTemplate å®ç°å ä½æ›¿æ¢
- ç»“æœåŒ–è¿”å›ï¼š é€šè¿‡`BeanOutputConverter`å®ç°beanå¯¹è±¡è½¬json schemaï¼Œç„¶åé€šè¿‡æç¤ºè¯å·¥ç¨‹çº¦æŸå¤§æ¨¡å‹è¿”å›ï¼›åŒæ—¶ä¹Ÿé€šè¿‡Converterå®ç°è¿”å›ç»“æœè½¬Beanå¯¹è±¡

æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¯•éªŒæ•ˆæœ

```text
# ç”¨äºæµ‹è¯•çš„æ–‡æœ¬ï¼Œç¤ºä¾‹æ¥æºäº https://ai.baidu.com/tech/nlp_apply/address

ç¤¼ç›’20ä¸ªå‰æ—çœé•¿æ˜¥å¸‚æœé˜³åŒºå¼€è¿è¡—é¢†ç§€æœé˜³å°åŒº ç”°ç”œ 18692093383

ç² 18682085605 å¹¿å·å¸‚å¤©æ²³åŒºè¿ç¦è·¯527å·å¹¿ä¸œé‡‘èå­¦é™¢
```

![](/imgs/column/springai/D02-3.webp)


ä»ä¸Šé¢çš„å®é™…è¡¨ç°ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæœ‰ä¸¤ä¸ªæ˜æ˜¾çš„é—®é¢˜

- è¡Œæ”¿åŒºåŸŸç¼–ç è¿”å›çš„ä¸ä¸€å®šå‡†ç¡®ï¼šå¦‚ä¸Šé¢çš„ `é•¿æ˜¥å¸‚æœé˜³åŒº` çš„è¡Œæ”¿åŒºåŸŸç¼–ç è¿”å›å°±ä¸å¯¹
- è¯¦ç»†åœ°å€æå–ä¸ä¸€å®šå‡†ç¡®ï¼šä¸Šå›¾ä¸­å¹¿å·å¸‚çš„è¿™ä¸ªåœ°å€ï¼Œä¸¤æ¬¡è¯·æ±‚çš„è¿”å›ä¸ä¸€æ ·ï¼Œä¸”ç»“æœä¸å®Œæ•´

ä»è¿™ä¸ªå¿«é€ŸåŸå‹æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒåŸºäºå¤§æ¨¡å‹åšåœ°å€è¯†åˆ«æ–¹å‘å¯è¡Œï¼Œä½†æ˜¯è¿˜éœ€è¦â€œè°ƒæ•™â€ â€”â€”â€”â€” å³éœ€è¦æœ‰ä¸€ä¸ªæ›´ç¨³å®šã€é«˜è´¨é‡è¾“å‡ºçš„æç¤ºè¯è®¾è®¡

### 2.4 Promptå·¥ç¨‹ï¼šå¼•å¯¼æ¨¡å‹è¾“å‡ºçš„å‡†ç¡®çš„ç»“æœ

ä¸Šé¢demoä¸­çš„æç¤ºè¯è¿‡äºç®€ç•¥ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªæ›´ç¬¦åˆå·¥ç¨‹åŒ–çš„æç¤ºè¯ï¼ˆæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹ [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼š ç¬¬äº”ç«  ä» Prompt åˆ° Prompt æ¨¡æ¿ä¸å·¥ç¨‹æ²»ç†](https://mp.weixin.qq.com/s/ZQbztqBq7_PzynG06N4-mg) çœ‹çœ‹å¦‚ä½•è®¾è®¡æ›´æ¨èçš„æç¤ºè¯ï¼‰


ç”±äºè¿™ä¸ªåœºæ™¯çš„ç›®æ ‡éå¸¸æ¸…æ™°ï¼Œæ‰€ä»¥å¯¹åº”çš„è®¾è®¡å¯ä»¥ä»ä¸‹é¢å‡ ä¸ªå‡ºå‘

- è§’è‰²ï¼šåœ°å€ä¿¡æ¯æå–ä¸“å®¶
- çº¦æŸï¼šä¸€äº›åœ°å€ç›¸å…³çš„æå–è§„åˆ™
- ç»“æ„åŒ–ï¼šè¿”å›çš„å®šä¹‰
- å°‘æ ·æœ¬å­¦ä¹ ï¼šæä¾›ç¤ºä¾‹ï¼Œç”¨äºå°‘æ ·æœ¬å­¦ä¹ 

ç„¶ååœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ”¹é€ ä¸€ä¸‹å…·ä½“çš„å®ç°ç­–ç•¥

```java
@RestController
public class ChatController {
    
    private static final String SYSTEM_PROMPT = """
        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åœ°å€ä¿¡æ¯æå–ä¸“å®¶ã€‚è¯·ä»ç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–åœ°å€ä¿¡æ¯ã€‚
                
        æå–è§„åˆ™ï¼š
        1. è¯†åˆ«å¹¶åˆ†ç¦»å‡ºï¼šçœä»½ã€åŸå¸‚ã€åŒºå¿ã€è¡—é“ã€è¯¦ç»†åœ°å€
        2. åœ°å€ç»„ä»¶å¯èƒ½å­˜åœ¨ç®€ç§°ã€åˆ«ç§°ï¼Œè¯·è½¬æ¢ä¸ºæ ‡å‡†åç§°
        3. å¦‚æœç”¨æˆ·è¾“å…¥åŒ…å«"çœ"ã€"å¸‚"ã€"åŒº"ã€"å¿"ç­‰å…³é”®è¯ï¼Œéœ€æ­£ç¡®å¤„ç†
                
        è¾“å‡ºæ ¼å¼è¦æ±‚ï¼š
        - çœä»½ï¼šå®Œæ•´çœä»½åç§°ï¼Œå¦‚"å¹¿ä¸œçœ"
        - åŸå¸‚ï¼šåœ°çº§å¸‚åç§°ï¼Œç›´è¾–å¸‚å¡«"åŒ—äº¬å¸‚"ç­‰
        - åŒºå¿ï¼šåŒºæˆ–å¿çº§å¸‚åç§°
        - è¡—é“ï¼šè¡—é“ã€ä¹¡é•‡åç§°
        - è¯¦ç»†åœ°å€ï¼šé—¨ç‰Œå·ã€å°åŒºã€æ¥¼æ ‹ç­‰
        - è¡Œæ”¿åŒºåŸŸç¼–ç ï¼šé€šå¸¸æ˜¯åŒºå¿ä¸€çº§çš„ç¼–ç ï¼Œ6ä½æ•°å­—
                
        ç¤ºä¾‹è¾“å…¥ï¼š"ç¤¼ç›’20ä¸ªå‰æ—çœé•¿æ˜¥å¸‚æœé˜³åŒºå¼€è¿è¡—é¢†ç§€æœé˜³å°åŒº ç”°ç”œ 18692093383"
        ç¤ºä¾‹è¾“å‡ºï¼š {
            "province": "å‰æ—çœ",
            "city": "é•¿æ˜¥å¸‚",
            "area": "æœé˜³åŒº",
            "street": "å¼€è¿è¡—é¢†ç§€æœé˜³å°åŒº",
            "adCode": "220104",
            "personName": "ç”°ç”œ",
            "personPhone": "18692093383"
        }
        """;
    
    private final ChatModel chatModel;

    private final ChatClient chatClient;

    @Autowired
    public ChatController(ChatModel chatModel) {
        this.chatModel = chatModel;
        this.chatClient = ChatClient.builder(chatModel)
                .defaultAdvisors(new SimpleLoggerAdvisor(ModelOptionsUtils::toJsonStringPrettyPrinter, ModelOptionsUtils::toJsonStringPrettyPrinter, 0))
                .defaultSystem(SYSTEM_PROMPT)
                .build();
    }

    @GetMapping("/ai/genAddressWithPromptTemplate")
    public Address generateAddressWithPromptTemplate(String content) {
        ChatClient.CallResponseSpec res = chatClient.prompt(content).call();
        Address address = res.entity(Address.class);
        return address;
    }
}
```

åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥æå–äº†ä¸€ä¸ªæç¤ºè¯æ¨¡æ¿ `SYSTEM_PROMPT` ï¼ˆè™½ç„¶ä¸Šé¢çš„ä»£ç æ˜¯ç›´æ¥ç¡¬ç¼–ç çš„æ–¹å¼å†™æˆçš„ï¼Œä½†æ˜¯æ›´æ¨èçš„æ˜¯ä½¿ç”¨æ›´ä¸“ä¸šçš„æç¤ºè¯ç®¡ç†æœåŠ¡æ¥ç»´æŠ¤ã€æ¯”å¦‚æ”¯æŒç‰ˆæœ¬ã€ç°åº¦å¯¹æ¯”ç­‰ï¼‰


å…¶æ¬¡å°±æ˜¯å…·ä½“çš„LLMäº¤äº’ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `ChatClient` æ›¿æ¢äº†æ›´åŸç”Ÿçš„ `ChatModel`ï¼Œå› ä¸ºå®ƒå¯¹ç³»ç»Ÿæç¤ºè¯ã€ç»“æ„åŒ–è¿”å›ä»ä½¿ç”¨è§’åº¦å°è£…å¾—æ›´å‹å¥½ï¼Œä½¿ç”¨èµ·æ¥æ›´ç®€å•ï¼›ä»ä»£ç é‡ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œä¸‰è¡Œå°±å®Œå‰é¢åŒç­‰çš„è°ƒç”¨è¿‡ç¨‹

åŒæ ·çš„æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“è¡¨ç°ï¼Œä¾ç„¶ä½¿ç”¨å‰é¢çš„æµ‹è¯•æ–‡æœ¬

![](/imgs/column/springai/D02-4.webp)

ä»ä¸Šé¢çš„ç»“æœæ¥çœ‹ï¼Œå¹¿å·å¸‚è¿™ä¸ªæ–‡æœ¬çš„è¯¦ç»†åœ°å€è§£æå°±ç¨³å®šå¯é å¤šäº†ï¼›ä½†æ˜¯å‰æ—è¿™ä¸ªåœ°å€è¡Œæ”¿åŒºåŸŸç¼–ç é”™è¯¯çš„é—®é¢˜ä¾æ—§ï¼Œæ˜¾ç„¶æç¤ºè¯æœ¬èº«æ˜¯æ— æ³•çº æ­£å¤§æ¨¡å‹çš„é”™è¯¯èµ„æ–™åº“çš„

æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦ç»™å¤§æ¨¡å‹å®‰ä¸Šâ€œä½œå¼Šå™¨â€ï¼Œè®©å®ƒæœ‰èƒ½åŠ›æŸ¥è¯¢åˆ°æ­£ç¡®çš„è¡Œæ”¿åŒºåŸŸç¼–ç 

### 2.5 Function Callå®ç°ï¼šè¡Œæ”¿åŒºåˆ’ç¼–ç æŸ¥è¯¢

è™½ç„¶æœ‰ä¸€äº›APIæä¾›äº†è¡Œæ”¿åŒºåŸŸç¼–ç ï¼ˆæ¯”å¦‚é«˜å¾·ï¼‰ï¼Œä½†æ˜¯ä¸ºäº†å‡å°‘å¤–éƒ¨ä¾èµ–ï¼ˆå½“ç„¶ä¹Ÿæ˜¯ä¸ºäº†ç™½å«–ï¼‰ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨æ ‡å‡†çš„è¡Œæ”¿ç¼–ç åº“æ¥æä¾›è‡ªå·±çš„æŸ¥è¯¢æœåŠ¡

é¦–å…ˆæ˜¯ä»å¼€æºé¡¹ç›®ä¸­è·å–æ•°æ®é›†ï¼š[https://github.com/modood/Administrative-divisions-of-China](https://github.com/modood/Administrative-divisions-of-China)

> ä¸ºäº†å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯ `pca-code.json` è¿™ä¸ªåŒ…å« çœã€å¸‚ã€åŒº ä¸‰çº§è”åŠ¨çš„æ•°æ®åº“ï¼ˆå› ä¸ºè¡—é“çš„å˜åŠ¨é¢‘ç‡ç›¸æ¯”è¾ƒäºè¿™ä¸‰çº§é«˜å¤ªå¤šäº†...ï¼‰

è¿™ä¸ªå­—å…¸çš„æ•°æ®æ¨¡å‹å½¢å¦‚

```json
[
    {
        "code": "11",
        "name": "åŒ—äº¬å¸‚",
        "children": [
            {
                "code": "1101",
                "name": "å¸‚è¾–åŒº",
                "children": [
                    {
                        "code": "110101",
                        "name": "ä¸œåŸåŒº"
                    },
                    {
                        "code": "110102",
                        "name": "è¥¿åŸåŒº"
                    }
                ]
            }
        ]
    }
]
```

å› æ­¤æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªç®€å•åŸºäºå†…å­˜çš„è¡Œæ”¿åŒºåŸŸæŸ¥è¯¢æœåŠ¡

- è¯»å–å­—å…¸ã€æ˜ å°„ä¸ºç»“æ„åŒ–æ•°æ®
- è§£æä¸ºMapæ ¼å¼ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾

ä¸‹é¢å°±æ˜¯ä¸€ä¸ªåŸºç¡€çš„åˆå§‹åŒ–å®ç°è¿‡ç¨‹ï¼ˆé˜…è¯»èµ·æ¥æœ‰å›°éš¾çš„å°ä¼™ä¼´ä¸å¦¨ç»“åˆAICodingè§£é‡Šä¸€ä¸‹ï¼‰

```java
@Service
public class AddressAdCodeService {
    private final Logger log = org.slf4j.LoggerFactory.getLogger(AddressAdCodeService.class);
    private final static String data = "data/pca-code.json";

    private volatile Map<String, ProvinceMapper> provinceMap;

    /**
     * ä» data/pca-code.json ä¸­åŠ è½½æ•°æ®ï¼Œå¹¶ç»“æ„åŒ–
     */
    @PostConstruct
    public void init() {
        try (InputStream stream = this.getClass().getClassLoader().getResourceAsStream(data)) {
            // è¯»å–æ•°æ®
            String content = IOUtils.toString(stream, UTF_8);
            ObjectMapper mapper = new ObjectMapper();
            // å°†contentååºåˆ—åŒ–ä¸º List<Province>
            List<Province> provinces = mapper.readValue(content, mapper.getTypeFactory().constructCollectionType(List.class, Province.class));

            // æ„å»ºç»“æ„åŒ–æ•°æ®ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾
            HashMap<String, ProvinceMapper> map = new HashMap<>();
            for (Province province : provinces) {
                ProvinceMapper provinceMap = new ProvinceMapper(province.code, province.name, new HashMap<>());
                map.put(province.name, provinceMap);
                for (City city : province.children) {
                    Map<String, Area> areaMap = CollectionUtils.isEmpty(city.children) ? Map.of() : city.children.stream().collect(Collectors.toMap(s -> s.name, s -> s));
                    CityMapper cityMap = new CityMapper(city.code, city.name, areaMap);
                    provinceMap.children.put(city.name, cityMap);
                }
            }
            this.provinceMap = map;
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

    public record Area(String code, String name) {
    }


    public record City(String code, String name, List<Area> children) {
    }

    public record CityMapper(String code, String name, Map<String, Area> children) {
    }

    public record Province(String code, String name, List<City> children) {
    }

    public record ProvinceMapper(String code, String name, Map<String, CityMapper> children) {
    }
}
```


è®©åå°±æ˜¯æä¾›æŸ¥è¯¢æœåŠ¡ï¼Œå¹¶é€šè¿‡SpringAI çš„ `@Tool` æ³¨è§£æ¥å£°æ˜ä¸ºå¤§æ¨¡å‹çš„å›è°ƒå·¥å…·

```java
// åŒæ ·åœ¨ AddressAdCodeService.java ç±»ä¸­

/**
 * æŸ¥è¯¢åœ°å€å¯¹åº”çš„è¡Œæ”¿ç¼–ç 
 *
 * @param province çœ
 * @param city     å¸‚
 * @param area     åŒº
 * @return è¡Œæ”¿ç¼–ç 
 */
@Tool(description = "ä¼ å…¥åœ°å€ä¿¡æ¯ï¼Œè¿”å›å¯¹åº”çš„è¡Œæ”¿åŒºåŸŸç¼–ç ï¼Œ å¦‚è¾“å…¥ æ¹–åŒ—çœæ­¦æ±‰å¸‚æ­¦æ˜ŒåŒºï¼Œè¿”å›çš„è¡Œæ”¿ç¼–ç ä¸º 420106")
public String queryAdCode(
        @ToolParam(description = "çœï¼Œå¦‚ æ¹–åŒ—çœ")
        String province,
        @ToolParam(description = "å¸‚ï¼Œå¦‚ æ­¦æ±‰å¸‚")
        String city,
        @ToolParam(description = "åŒºï¼Œå¦‚ æ­¦æ˜ŒåŒº")
        String area) {
    log.info("queryAdCode: {}, {}, {}", province, city, area);
    ProvinceMapper provinceMap = this.provinceMap.get(province);
    if (StringUtils.isBlank(city)) {
        return provinceMap.code;
    }
    CityMapper cityMap = provinceMap.children.get(city);
    if (cityMap == null) {
        // å¸‚æœªæŸ¥åˆ°ï¼Œè¿”å›çœçš„è¡Œæ”¿ç¼–ç 
        return provinceMap.code;
    }
    if (StringUtils.isBlank(area)) {
        return cityMap.code;
    }

    Area ar = cityMap.children.get(area);
    if (ar == null) {
        // åŒºæœªæŸ¥åˆ°ï¼Œè¿”å›å¸‚çš„ç¼–ç 
        return cityMap.code;
    }
    return ar.code;
}
```

### 2.6 å®Œå…¨ä½“æ™ºèƒ½åœ°å€æå–

ä¸Šé¢è™½ç„¶å®ç°äº†è¡Œæ”¿åŒºåŸŸæŸ¥è¯¢æœåŠ¡ï¼Œä½†æ˜¯è¿˜éœ€è¦æŠŠå®ƒæä¾›ç»™å¤§æ¨¡å‹ä½¿ç”¨ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬éœ€è¦æ€ä¹ˆåšå‘¢ï¼Ÿ

çœ‹ä¸‹é¢çš„å®ç°ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªæ”¹åŠ¨éå¸¸ç®€å•ï¼Œåªéœ€ä¸¤æ­¥ï¼š

- è°ƒæ•´æç¤ºè¯çº¦æŸï¼šè¦æ±‚å¤§æ¨¡å‹å¿…é¡»é€šè¿‡æä¾›çš„å·¥å…·æ¥è·å–è¡Œæ”¿åŒºåŸŸç¼–ç 
- æ³¨å†Œå·¥å…·

```java

@RestController
public class ChatController {

  // æ³¨æ„ä¸‹é¢æå–è§„åˆ™ä¸­çš„ç¬¬å››ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬æ–°å¢çš„çº¦æŸ
  private static final String SYSTEM_PROMPT = """
            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åœ°å€ä¿¡æ¯æå–ä¸“å®¶ã€‚è¯·ä»ç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–åœ°å€ä¿¡æ¯ã€‚
                    
            æå–è§„åˆ™ï¼š
            1. è¯†åˆ«å¹¶åˆ†ç¦»å‡ºï¼šçœä»½ã€åŸå¸‚ã€åŒºå¿ã€è¡—é“ã€è¯¦ç»†åœ°å€
            2. åœ°å€ç»„ä»¶å¯èƒ½å­˜åœ¨ç®€ç§°ã€åˆ«ç§°ï¼Œè¯·è½¬æ¢ä¸ºæ ‡å‡†åç§°
            3. å¦‚æœç”¨æˆ·è¾“å…¥åŒ…å«"çœ"ã€"å¸‚"ã€"åŒº"ã€"å¿"ç­‰å…³é”®è¯ï¼Œéœ€æ­£ç¡®å¤„ç†
            4. è¡Œæ”¿åŒºåŸŸç¼–ç å¿…é¡»ä½¿ç”¨æä¾›çš„å·¥å…· queryAdCode è¿›è¡Œè·å–
                    
            è¾“å‡ºæ ¼å¼è¦æ±‚ï¼š
            - çœä»½ï¼šå®Œæ•´çœä»½åç§°ï¼Œå¦‚"å¹¿ä¸œçœ"
            - åŸå¸‚ï¼šåœ°çº§å¸‚åç§°ï¼Œç›´è¾–å¸‚å¡«"åŒ—äº¬å¸‚"ç­‰
            - åŒºå¿ï¼šåŒºæˆ–å¿çº§å¸‚åç§°
            - è¡—é“ï¼šè¡—é“ã€ä¹¡é•‡åç§°
            - è¯¦ç»†åœ°å€ï¼šé—¨ç‰Œå·ã€å°åŒºã€æ¥¼æ ‹ç­‰
            - è¡Œæ”¿åŒºåŸŸç¼–ç ï¼šé€šå¸¸æ˜¯åŒºå¿ä¸€çº§çš„ç¼–ç ï¼Œ6ä½æ•°å­—
                    
            ç¤ºä¾‹è¾“å…¥ï¼š"ç¤¼ç›’20ä¸ªå‰æ—çœé•¿æ˜¥å¸‚æœé˜³åŒºå¼€è¿è¡—é¢†ç§€æœé˜³å°åŒº11æ ‹2å·æ¥¼304 ç”°ç”œ 18692093383"
            ç¤ºä¾‹è¾“å‡ºï¼š {
                "province": "å‰æ—çœ",
                "city": "é•¿æ˜¥å¸‚",
                "area": "æœé˜³åŒº",
                "street": "å¼€è¿è¡—é¢†ç§€æœé˜³å°åŒº",
                "detailInfo": "11æ ‹2å·æ¥¼304",
                "adCode": "220104",
                "personName": "ç”°ç”œ",
                "personPhone": "18692093383"
            }
            """;

    private final ChatModel chatModel;

    private final ChatClient chatClient;

    private final AddressAdCodeService addressAdCodeService;

    @Autowired
    public ChatController(ChatModel chatModel, AddressAdCodeService addressAdCodeService) {
        this.chatModel = chatModel;
        this.addressAdCodeService = addressAdCodeService;
        this.chatClient = ChatClient.builder(chatModel)
                .defaultAdvisors(new SimpleLoggerAdvisor(ModelOptionsUtils::toJsonStringPrettyPrinter, ModelOptionsUtils::toJsonStringPrettyPrinter, 0))
                .defaultSystem(SYSTEM_PROMPT)
                .build();
    }

    @GetMapping("/ai/genAddressWithCodeTool")
    public Address generateAddressWithCodeTool(String content) {
        // ç›´æ¥ä½¿ç”¨ tools() æ¥æ³¨å†Œå¤§æ¨¡å‹å›è°ƒçš„å·¥å…· 
        ChatClient.CallResponseSpec res = chatClient.prompt(content).tools(addressAdCodeService).call();
        Address address = res.entity(Address.class);
        return address;
    }
}
```

å†æ¬¡è¯•éªŒä¸€ä¸‹å®é™…è¡¨ç°

![](/column/imgs/springai/D02-5.webp)


### 2.7 æ•´ä½“æµç¨‹

æ¥ä¸‹æ¥æˆ‘ä»¬ä»æ•´ä½“çš„è§†è§’å›å½’ä¸€ä¸‹è¿™ä¸ªæ™ºèƒ½åœ°å€æå–çš„å…¨æµç¨‹ï¼Œå…¶ä¸­ç›¸å…³çš„æŠ€æœ¯ç‚¹ä¸º

- æç¤ºè¯å·¥ç¨‹
- ç»“æ„åŒ–è¿”å›
- Function Callå·¥å…·è°ƒç”¨

![](/column/imgs/springai/D02-6.webp)

```Mermaid
flowchart TD
    A[ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€åœ°å€] --> B{åœ°å€è§£ææ™ºèƒ½ä½“}
    
    B --> C[Promptå·¥ç¨‹ä¼˜åŒ–]
    C --> D[è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹]
    D --> F[æå–ç»“æ„åŒ–åœ°å€]
    
    F --> H[ç”Ÿæˆæ ‡å‡†åŒ–åœ°å€]
    F --> I[é€šè¿‡Function Call<br>æŸ¥è¯¢è¡Œæ”¿ç¼–ç ]
    
    I --> J{ç¼–ç æŸ¥è¯¢ç»“æœ?}
    J -->|æˆåŠŸ| K[è·å–è¡Œæ”¿åŒºåŸŸç¼–ç ]
    J -->|å¤±è´¥| L[ä½¿ç”¨é»˜è®¤ç¼–ç ]
    
    K --> M[ç»„è£…å®Œæ•´ç»“æœ]
    L --> M
    
    M --> N[è¾“å‡ºæ ‡å‡†åŒ–åœ°å€<br>+è¡Œæ”¿ç¼–ç ]
    
    style A fill:#e1f5fe,stroke:#01579b
    style B fill:#bbdefb,stroke:#0d47a1,stroke-width:2px
    style D fill:#f3e5f5,stroke:#4a148c
    style F fill:#c8e6c9,stroke:#2e7d32
    style I fill:#fff3e0,stroke:#e65100
    style K fill:#d1c4e9,stroke:#4527a0
    style M fill:#fce4ec,stroke:#ad1457
    style N fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
```


## ä¸‰ã€ç”Ÿäº§ä¼˜åŒ–åŠéƒ¨ç½²

### 3.1 è°ƒå‚ï¼šç¨³å®šæ€§è¾“å‡º

åœ¨å®é™…çš„ç”Ÿäº§ä½“éªŒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¤§æ¦‚ç‡ä¼šå‘ç°ï¼ŒåŒæ ·ä¸€æ®µè‡ªç„¶è¯­è¨€ï¼Œå¤§æ¨¡å‹æå–çš„è¯¦ç»†åœ°å€è¿™å—ï¼Œå¯èƒ½å¹¶ä¸æ€»æ˜¯ç›¸åŒçš„ï¼Œwhy? 

å¯¹äºçœå¸‚åŒºè¿™ä¸‰ä¸ªç›¸å¯¹æ¥è¯´æ¯”è¾ƒå›ºå®šçš„åœ°å€ä¿¡æ¯ï¼Œå¯¹äºè¡—é“é—¨ç‰Œå·çš„å¯èƒ½æ€§å®åœ¨æ˜¯å¤ªå¤šï¼Œå¤§æ¨¡å‹ä¸­æœ‰ä¸€ä¸ªå‚æ•° `temperature` å®ƒä¼šæ§åˆ¶å¤§æ¨¡å‹é¢„æµ‹ç»“æœçš„å€¾å‘ï¼Œå¯¹æ­¤æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚ç…§ [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬äºŒç«  æ¨¡å‹ä¸æ˜¯é‡ç‚¹ï¼Œå‚æ•°æ‰æ˜¯ä½ çœŸæ­£çš„æ§åˆ¶é¢æ¿](https://mp.weixin.qq.com/s/t_BuAW9i0npcaJdua3Am2Q)

åœ¨æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œå¾ˆæ˜æ˜¾ä¸å¸Œæœ›å¤§æ¨¡å‹è‡ªç”±å‘æŒ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†`temperature`è®¾ç½®è¾ƒä½ï¼Œç¡®ä¿è¾“å‡ºç»“æœç¨³å®š

æˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„å°±æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„`spring.ai.zhipuai.chat.options.temperature`ï¼Œå¦‚ä¸‹

```yaml
spring:
  ai:
    zhipuai:
      # api-key ä½¿ç”¨ä½ è‡ªå·±ç”³è¯·çš„è¿›è¡Œæ›¿æ¢ï¼›å¦‚æœä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°è¿›è¡Œè®¾ç½®
      api-key: ${zhipuai-api-key}
      chat:
        options:
          model: GLM-4-Flash
          temperature: 0.2
```

### 3.2 Dockerå®¹å™¨åŒ–éƒ¨ç½²

```dockerfile
# Dockerfile
FROM openjdk:17-jdk-slim
WORKDIR /app
COPY target/D03-text-address-extraction-0.0.1-SNAPSHOT.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar", 
            "--spring.ai.zhipuai.api-key=${ZHIPU_KEY}"]
```

### 3.3 Kuberneteséƒ¨ç½²é…ç½®

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: address-agent
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: address-agent
        image: address-agent:1.0.0
        env:
        - name: OPENAI_KEY
          valueFrom:
            secretKeyRef:
              name: ai-secrets
              key: api-key
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
```


## å››ã€å°ç»“

### 4.1 æ™ºèƒ½ä½“ or NO?

ä»ä¸Šåˆ°ä¸‹é¡ºä¸‹æ¥ï¼Œæˆ‘ä»¬çš„æ™ºèƒ½åœ°å€æå–åŸºæœ¬å·²ç»å®Œæˆï¼Œä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§æ¨¡å‹çš„èƒ½åŠ›åŒ…è£…æœåŠ¡ï¼Œé‚£ä¹ˆå®ƒç®—â€œæ™ºèƒ½ä½“â€å—ï¼Ÿ 

å¥½åƒä¹Ÿä¸å¤ªç®—~ï¼Œå“ªä¸ªæ™ºèƒ½ä½“è¿™ä¹ˆç®€å•å‘¢~ğŸ¤£

ä½†è‹¥ä»ä¸‹é¢è¿™äº›è§’åº¦å‡ºå‘ï¼Œå®ƒåˆç®—æ˜¯ä¸€ä¸ªéå¸¸å‚ç›´çš„å·¥å…·å¢å¼ºå‹æ™ºèƒ½ä½“ï¼š

1.  **ç›®æ ‡å¯¼å‘**ï¼šç”¨æˆ·è¾“å…¥çš„æ˜¯**è‡ªç„¶è¯­è¨€ç›®æ ‡**â€”â€”â€œä»è¿™æ®µæ–‡å­—é‡Œæå–åœ°å€å¹¶æŸ¥æ¸…æ¥šå®ƒçš„è¡Œæ”¿åŒºåˆ’ç¼–ç â€ï¼Œè€Œä¸æ˜¯â€œå…ˆè°ƒç”¨NLPæ¨¡å‹è§£æï¼Œå†ç”¨ç»“æœé‡Œçš„çœå¸‚å»æŸ¥XX APIâ€ã€‚
2.  **è‡ªä¸»è§„åˆ’ä¸æ¨ç†**ï¼šç³»ç»Ÿå†…éƒ¨è‡ªåŠ¨å®Œæˆäº†è§„åˆ’ï¼šâ‘  è¯†åˆ«å‡ºè¿™æ˜¯åœ°å€æå–ä»»åŠ¡ -> â‘¡ è°ƒç”¨LLMè¿›è¡Œç»“æ„åŒ–è§£æ -> â‘¢ åˆ¤æ–­æ˜¯å¦éœ€è¦å¹¶è¯·æ±‚è¡Œæ”¿ç¼–ç  -> â‘£ è°ƒç”¨å¤–éƒ¨å‡½æ•°è·å–ç¼–ç  -> â‘¤ æ•´åˆç»“æœã€‚**è¿™ä¸ªå†³ç­–é“¾æ¡æ˜¯æ™ºèƒ½ä½“è‡ªä¸»ç”Ÿæˆçš„**ã€‚
3.  **æ ¸å¿ƒå·¥å…·ä½¿ç”¨**ï¼šå…¶æ ¸å¿ƒèƒ½åŠ› `Function Calling` æ­£æ˜¯æ™ºèƒ½ä½“çš„æ ‡å¿—æ€§ç‰¹å¾ã€‚LLMä½œä¸ºâ€œå¤§è„‘â€ï¼Œå†³å®šä½¿ç”¨ `queryAdCode` è¿™ä¸ªâ€œå·¥å…·â€ï¼ˆæ‰‹æˆ–è„šï¼‰ã€‚
4.  **å¯æ‰©å±•çš„äº¤äº’ä¸è®°å¿†**ï¼šè™½ç„¶å½“å‰ç‰ˆæœ¬å¯èƒ½æ˜¯å•æ¬¡æŸ¥è¯¢ï¼Œä½†å®ƒå¾ˆå®¹æ˜“æ‰©å±•ä¸ºå¤šè½®å¯¹è¯ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è¯´â€œåœ°å€ä¸å¯¹ï¼Œæˆ‘æŒ‡çš„æ˜¯æ­å·çš„è¥¿æ¹–åŒºâ€ï¼Œæ™ºèƒ½ä½“å¯ä»¥è®°ä½ä¸Šä¸‹æ–‡ï¼Œé‡æ–°æŸ¥è¯¢ã€‚

**å¯¹æ¯”ä¸€ä¸ªéæ™ºèƒ½ä½“çš„ä¼ ç»Ÿæ–¹æ¡ˆï¼š**

ä¸€ä¸ªä¼ ç»Ÿçš„åœ°å€è§£ææœåŠ¡å¯èƒ½æä¾›ä¸€ä¸ªå¤æ‚çš„APIè¡¨å•ï¼Œè¦æ±‚ç”¨æˆ·è‡ªå·±å…ˆåˆ†è¯ï¼Œç„¶ååˆ†åˆ«å¡«å†™`province`ã€`city`ã€`district`ç­‰å­—æ®µæ¥æŸ¥è¯¢ç¼–ç ã€‚

ç”¨æˆ·æ‰¿æ‹…äº†æ‰€æœ‰çš„è§„åˆ’å’Œæ¨ç†å·¥ä½œï¼›è€Œè¿™ä¸ªæ™ºèƒ½åœ°å€æå–ï¼Œå°±å¾ˆâ€œæ™ºèƒ½â€äº†

### 4.2 ç‰¹ç‚¹

æœ€åé’ˆå¯¹æœ¬æ–‡çš„å†…å®¹ï¼Œæ•´ä½“å°ç»“ä¸€ä¸‹ï¼šé€šè¿‡æœ¬æ–‡ä»‹ç»çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ™ºèƒ½åœ°å€è§£æç³»ç»Ÿï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **è‡ªç„¶è¯­è¨€ç†è§£**ï¼šåˆ©ç”¨å¤§æ¨¡å‹å¤„ç†å„ç§è‡ªç”±æ ¼å¼çš„åœ°å€è¾“å…¥
3. **æç¤ºè¯æ¨¡æ¿**ï¼šé€šè¿‡æ„å»ºç»“æ„åŒ–çš„æç¤ºè¯ç®¡ç†ï¼Œæé«˜å¤§æ¨¡å‹çš„è¿”å›è´¨é‡
3. **ç»“æ„åŒ–è¾“å‡º**ï¼šç¡®ä¿è¾“å‡ºç¬¦åˆæ ‡å‡†åŒ–è¦æ±‚
4. **å®æ—¶ç¼–ç æŸ¥è¯¢**ï¼šé€šè¿‡function callåŠ¨æ€è·å–è¡Œæ”¿åŒºåŸŸç¼–ç 

### 4.3 æœªæ¥æ‰©å±•æ–¹å‘ï¼š

1. **å¤šæ¨¡å‹æ”¯æŒ**ï¼šé›†æˆæœ¬åœ°åŒ–å¤§æ¨¡å‹é™ä½APIæˆæœ¬
2. **åœ°å€è¡¥å…¨ä¸çº é”™**ï¼šå¯¹ä¸å®Œæ•´æˆ–é”™è¯¯åœ°å€è¿›è¡Œæ™ºèƒ½ä¿®æ­£
3. **å›½é™…åŒ–æ”¯æŒ**ï¼šå¤„ç†å¤šè¯­è¨€åœ°å€è§£æ
4. **GISé›†æˆ**ï¼šç»“åˆåœ°ç†ä¿¡æ¯ç³»ç»Ÿæä¾›åæ ‡æ˜ å°„
5. **å®æ—¶æ›´æ–°**ï¼šè‡ªåŠ¨åŒæ­¥æœ€æ–°çš„è¡Œæ”¿åŒºåˆ’å˜æ›´

é€šè¿‡ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼Œä¸åˆ°200è¡Œä»£ç ï¼Œå®ç°ä¸€ä¸ªâ€œåœ°å€æå–æ™ºèƒ½ä½“â€ï¼Œç»™å¤§å®¶æä¾›ä¸€ä¸ªå…³äºå¤§æ¨¡å‹åº”ç”¨å¼€å‘çš„æ¡ˆä¾‹ï¼›å½“ç„¶æœ¬ç¯‡å†…å®¹ä¹Ÿæ˜¯ä½œä¸ºç†è®ºç§‘æ™®ç³»åˆ—æ•™ç¨‹çš„å®æˆ˜ç¯‡ï¼Œå¼ºçƒˆå»ºè®®å¯¹å¤§æ¨¡å‹åº”ç”¨å¼€å‘æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œçœ‹çœ‹ä»¥ä¸‹å‡ ç¯‡å†…å®¹ï¼ˆæ¯ç¯‡è€—æ—¶ä¸è¶…è¿‡äº”åˆ†é’ŸğŸ˜Šï¼‰

- [LLM åº”ç”¨å¼€å‘æ˜¯ä»€ä¹ˆï¼šé›¶åŸºç¡€ä¹Ÿå¯ä»¥è¯»æ‡‚çš„ç§‘æ™®æ–‡(æç®€ç‰ˆ)](https://mp.weixin.qq.com/s/qCn8x2XO2shA8MheYbHq0w)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šåº-ä¸ºä»€ä¹ˆä½ â€œä¼šç”¨ LLMâ€ï¼Œä½†åšä¸å‡ºå¤æ‚åº”ç”¨ï¼Ÿ](https://mp.weixin.qq.com/s/2GXBNOUq3jlysipftz8TpA)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¸€ç« LLMåˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ](https://mp.weixin.qq.com/s/v-z6EHY300ElOxdGPdzc0w)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬äºŒç«  æ¨¡å‹ä¸æ˜¯é‡ç‚¹ï¼Œå‚æ•°æ‰æ˜¯ä½ çœŸæ­£çš„æ§åˆ¶é¢æ¿](https://mp.weixin.qq.com/s/t_BuAW9i0npcaJdua3Am2Q)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬ä¸‰ç«  ä¸ºä»€ä¹ˆæˆ‘çš„Promptè¡¨ç°å¾ˆç³Ÿï¼Ÿ](https://mp.weixin.qq.com/s/vzt0bGwcfnASOiBa0Kc7VQ)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬å››ç« Prompt çš„å·¥ç¨‹åŒ–ç»“æ„è®¾è®¡](https://mp.weixin.qq.com/s/Nk-N34TLJVCTI5F4k5rGaQ)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬äº”ç«  ä» Prompt åˆ° Prompt æ¨¡æ¿ä¸å·¥ç¨‹æ²»ç†](https://mp.weixin.qq.com/s/ZQbztqBq7_PzynG06N4-mg)
- [å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹ï¼šç¬¬å…­ç«  ä¸Šä¸‹æ–‡çª—å£çš„çœŸå®è¾¹ç•Œ](https://mp.weixin.qq.com/s/nnKspRO87xbrn4-LBV3RNA)
